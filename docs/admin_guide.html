<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" name="Author" content="Douglas Lau"/>
	<link href="iris_doc.css" rel="stylesheet" type="text/css"/>
	<title>IRIS Administrator Guide</title>
	<script type="text/javascript" src="admin_guide.js"></script>
</head>

<body>
<nav class="sidebar">
  <h1><a id="contents_link" href="#admin_guide">Contents</a></h1>
  <div id="contents_div"><!-- div required for js, DO NOT REMOVE --></div>
  <h2><a id="overview_link" href="#overview">Overview</a></h2>
  <div id="overview_div">
    <h3><a href="#architecture">System Architecture</a></h3>
    <h3><a href="#device_types">Device Types</a></h3>
    <h3><a href="#protocols">Protocols</a></h3>
    <h3><a href="#advanced_features">Advanced Features</a></h3>
  </div>
  <h2><a id="installation_link" href="#installation">Installation</a></h2>
  <div id="installation_div">
    <h3><a href="#operating_system">Operating System</a></h3>
    <h3><a href="#install_iris">Install IRIS</a></h3>
    <h3><a href="#init_iris">Initialize IRIS</a></h3>
    <h3><a href="#server_properties">Server Properties</a></h3>
    <h3><a href="#start_services">Start Services</a></h3>
    <h3><a href="#initial_login">Initial Login</a></h3>
  </div>
  <h2><a id="basic_setup_link" href="#basic_setup">Basic Setup</a></h2>
  <div id="basic_setup_div">
    <h3><a href="#client_properties">Client Properties</a></h3>
    <h3><a href="#user_properties">User Properties</a></h3>
    <h3><a href="#edit_mode">Edit Mode</a></h3>
    <h3><a href="#system_attributes">System Attributes</a></h3>
    <h3><a href="#users_and_roles">Users and Roles</a></h3>
    <h3><a href="#mapping">Mapping</a></h3>
    <h3><a href="#road_topology">Road Topology</a></h3>
    <h3><a href="#comm_links">Comm Links</a></h3>
    <h3><a href="#controllers">Controllers</a></h3>
    <h3><a href="#fonts">Fonts</a></h3>
  </div>
  <h2><a id="devices_link" href="#devices">Devices</a></h2>
  <div id="devices_div">
    <h3><a href="#dms">Dynamic Message Signs</a></h3>
    <h3><a href="#cameras">Cameras</a></h3>
    <h3><a href="#vds">Vehicle Detection</a></h3>
    <h3><a href="#lcs">Lane-Use Control Signs</a></h3>
    <h3><a href="#ramp_meters">Ramp Meters</a></h3>
    <h3><a href="#gate_arms">Gate Arms</a></h3>
    <h3><a href="#tag_readers">Tag Readers</a></h3>
    <h3><a href="#beacons">Beacons</a></h3>
    <h3><a href="#alarms">Alarms</a></h3>
    <h3><a href="#rwis">Road Weather Information Systems</a></h3>
    <h3><a href="#lane_marking">Lane Marking</a></h3>
  </div>
  <h2><a id="features_link" href="#features">Features</a></h2>
  <div id="features_div">
    <h3><a href="#traffic_layer">Traffic Map Layer</a></h3>
    <h3><a href="#incident_management">Incident Management</a></h3>
    <h3><a href="#action_plans">Action Plans</a></h3>
    <h3><a href="#schedules">Date/Time Schedules</a></h3>
    <h3><a href="#travel_time">Travel Time Estimation</a></h3>
    <h3><a href="#vsa">Variable Speed Advisory</a></h3>
    <h3><a href="#slow">Slow Traffic Warning</a></h3>
    <h3><a href="#tolling">Tolling</a></h3>
    <h3><a href="#metering_strategies">Ramp Metering Strategies</a></h3>
    <h3><a href="#spellchecker">Spell Checker</a></h3>
  </div>
  <h2><a id="troubleshooting_link" href="#troubleshooting">Troubleshooting</a></h2>
  <div id="troubleshooting_div">
    <h3><a href="#error_logs">Error Logs</a></h3>
    <h3><a href="#xml_output">Realtime XML Output</a></h3>
    <h3><a href="#event_tables">Database Event Tables</a></h3>
    <h3><a href="#debug_logs">Debug Trace Logs</a></h3>
  </div>
  <h2><a id="maintenance_link" href="#maintenance">Maintenance</a></h2>
  <div id="maintenance_div">
    <h3><a href="#database_backups">Database Backups</a></h3>
    <h3><a href="#iris_upgrades">IRIS Upgrades</a></h3>
    <h3><a href="#system_updates">System Software Updates</a></h3>
    <h3><a href="#monitoring_logs">Monitoring Logs</a></h3>
  </div>
  <h2><a id="development_link" href="#development">Development</a></h2>
  <div id="development_div">
    <h3><a href="#building">Building</a></h3>
    <h3><a href="#history">History</a></h3>
    <h3><a href="#future_plans">Future Plans</a></h3>
    <h3><a href="#contributing">Contributing</a></h3>
    <h3><a href="#coding_style">Coding Style</a></h3>
  </div>
  <h2><a id="stepbystep_link" href="#stepbystep">Step-by-step</a></h2>
  <div id="stepbystep_div">
    <h3><a href="#adddms">Create a DMS, Comm Link, and Controller</a></h3>
    <h3><a href="#createplan">Create a Plan to Activate DMS Messages</a></h3>
  </div>
</nav>

<main class="mainbar">
<header>
<div id="stamp">19 August 2016</div>
</header>
<h1 id="admin_guide"><span class="left"><img src="iris_icon.svg"/></span>
	IRIS Administrator Guide</h1>

<h2 id="overview">Overview</h2>
<p>
	IRIS is an <a href="http://www.opensource.org/docs/osd">open source</a>
	advanced traffic management system.
	It provides an integrated platform for transportation agencies to
	manage traffic monitoring and control devices.
	The software is written in <a href="http://www.java.com">Java</a> and
	licensed for anyone to use under the
	<a href="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">GPL</a>.
	In addition, all dependencies required to install and operate an IRIS
	system are available as free software.
	IRIS stands for Intelligent Roadway Information System.
</p>
<p>
	The IRIS software presents an intuitive map-based interface to system
	operators.
	This user interface has been refined over many iterations by getting
	feedback from operators to streamline their workflow.
</p>

<h3 id="architecture">System Architecture</h3>

<figure>
<svg class="right" xmlns="http://www.w3.org/2000/svg" version="1.1"
     width="640" height="480">
  <title>System Architecture</title>
  <defs>
    <marker id="Arrow1Mend" orient="auto" style="overflow:visible">
      <path d="M 0,0 5,-5 -12.5,0 5,5 0,0 z"
            transform="matrix(-0.4,0,0,-0.4,-4,0)"
            style="stroke:#000;stroke-width:1pt;marker-start:none"/>
    </marker>
  </defs>
  <g style="font-size:20px;font-family:Liberation Sans">
    <text style="font-size:28px">
      <tspan x="384" y="64">IRIS System</tspan>
      <tspan x="384" y="94">Architecture</tspan>
    </text>
    <g transform="translate(112,24)">
      <g style="fill:#c4f9ff;stroke:#000;stroke-width:2">
        <g style="opacity:0.5">
          <rect x="16" y="16" width="200" height="88" ry="8"
                style="opacity:0.5"/>
          <rect x="8" y="8" width="200" height="88" ry="8"/>
        </g>
        <rect x="0" y="0" width="200" height="88" ry="8"/>
      </g>
      <text>
        <tspan x="48" y="48">IRIS Clients</tspan>
      </text>
    </g>
    <g transform="translate(16,176)">
      <rect x="0" y="0" width="176" height="104" ry="8"
        style="fill:#ffe6c4;stroke:#000;stroke-width:2"/>
      <text>
        <tspan x="16" y="40">Apache Server</tspan>
        <tspan x="24" y="60">- Client JARs</tspan>
        <tspan x="24" y="80">- Map Tiles</tspan>
      </text>
    </g>
    <g transform="translate(232,176)">
      <rect x="0" y="0" width="192" height="120" ry="8"
            style="fill:#e2c4ff;stroke:#000;stroke-width:2"/>
      <text>
        <tspan x="40" y="60">IRIS Server</tspan>
      </text>
    </g>
    <g transform="translate(464,188)">
      <rect x="0" y="0" width="160" height="108" ry="8"
        style="fill:#d0ffc4;stroke:#000;stroke-width:2"/>
      <text>
        <tspan x="16" y="40">Authentication</tspan>
        <tspan x="16" y="60">Server (LDAP)</tspan>
        <tspan x="32" y="80" style="font-style:italic">(Optional)</tspan>
      </text>
    </g>
    <g transform="translate(96,360)">
      <g style="fill:#f6ffc4;stroke:#000;stroke-width:2">
        <g style="opacity:0.5">
          <rect x="16" y="16" width="208" height="88" ry="8"
                style="opacity:0.5"/>
          <rect x="8" y="8" width="208" height="88" ry="8"/>
        </g>
        <rect x="0" y="0" width="208" height="88" ry="8"/>
      </g>
      <text>
        <tspan x="16" y="40">Traffic Monitoring</tspan>
        <tspan x="16" y="60">and Control Devices</tspan>
      </text>
    </g>
    <g transform="translate(368,360)">
      <rect x="0" y="0" width="152" height="88" ry="8"
        style="fill:#c4d1ff;stroke:#000;stroke-width:2" />
      <text>
        <tspan x="16" y="40">Database</tspan>
        <tspan x="16" y="60">(PostgreSQL)</tspan>
      </text>
    </g>
    <g style="stroke:#000;stroke-width:2;marker-end:url(#Arrow1Mend)">
      <path d="m 176,112 -32,64"/>
      <path d="m 256,112 32,64"/>
      <path d="m 424,240 40,8"/>
      <path d="m 272,296 -32,64"/>
      <path d="m 368,296 32,64"/>
    </g>
  </g>
</svg>
</figure>

<p>
	The software has a client/server architecture.
	System configuration data is stored in a
	<a href="http://www.postgresql.org">PostgreSQL</a> database,
	and managed by the IRIS server.
	The server also handles communication with all traffic control and
	data collection devices.
	The client software is distributed by an <a
	href="http://projects.apache.org/projects/http_server.html">Apache</a>
	web server, using Java Web Start.
	All communication between the server and clients is encrypted using
	secure socket layer (SSL).
	The server may be configured to pass authentication requests off to an
	external LDAP server, allowing IRIS to integrate into an existing
	authentication system.
</p>

<h3 id="device_types">Device Types</h3>
<p>
	IRIS is able to manage several different types of traffic monitoring and
	control devices.
	These include:
</p>
<ul>
	<li><a href="#dms">DMS</a> (dynamic message signs)</li>
	<li><a href="#cameras">CCTV cameras</a> and
	    <a href="#video">Video switchers</a>
	</li>
	<li><a href="#vds">VDS</a> (vehicle detection systems)</li>
	<li><a href="#lcs">LCS</a> (lane-use control signs)</li>
	<li><a href="#ramp_meters">Ramp meters</a></li>
	<li><a href="#gate_arms">Gate Arms</a></li>
	<li><a href="#tag_readers">Tag Readers</a></li>
	<li><a href="#beacons">Beacons</a></li>
	<li><a href="#rwis">RWIS</a> (road-weather information systems)</li>
	<li><a href="#lane_marking">In-road lighting</a> (dynamic striping)</li>
</ul>
<h3 id="protocols">Protocols</h3>
<p>
	Many different protocols are supported for communicating with the
	various device types.
	Additional protocols can be added for any existing device type by
	programming a simple driver interface.
	These are some existing protocols:
</p>
<ul>
	<li>NTCIP class A, B and C (DMS)</li>
	<li>DMS-XML (DMS)</li>
	<li>Addco NodeComm (DMS)</li>
	<li>MnDOT 4- and 5-bit (VDS, ramp meters, LCS, beacons, IRL)</li>
	<li>Wavetronix SS105 and SS125 (VDS)</li>
	<li>Canoga Traffic Sensing System (VDS)</li>
	<li>RTMS G4 (VDS)</li>
	<li>Pelco D (pan/tilt/zoom)</li>
	<li>Infinova (pan/tilt/zoom)</li>
	<li>Cohu (pan/tilt/zoom)</li>
	<li>AD "manchester" (pan/tilt/zoom)</li>
	<li>Vicon (pan/tilt/zoom)</li>
	<li>Msg Feed (external system DMS messages)</li>
	<li>Pelco Video Switcher</li>
	<li>HySecurity STC (Gate Arms)</li>
	<li>Optical Scientific ORG-815 (precipitation)</li>
	<li>SSI RWIS sensor</li>
	<li>DLI DIN Relay (LCS, beacons)</li>
	<li>Control By Web (beacons)</li>
	<li>Incident Feed (external system provided)</li>
</ul>
<h3 id="advanced_features">Advanced Features</h3>
<p>
	IRIS also contains some higher-level traffic management features:
</p>
<ul>
	<li>Continuously updated traffic map (density, speed or flow)</li>
	<li>Scheduled deployment of control devices</li>
	<li>Incident management</li>
	<li>Travel time estimation for traveler information</li>
	<li>Variable speed advisories</li>
	<li>Coordinated ramp metering strategies</li>
	<li>High-occupancy / toll (HOT) lane operation</li>
</ul>

<h2 id="installation">Installation</h2>
<p/>

<h3 id="operating_system">Operating System</h3>
<p>
	Install <a href="http://fedoraproject.org">Fedora</a> onto the server
	computer.
	Other operating systems, such as Red Hat Enterprise Linux, can also be
	used, but the procedures may vary slightly.
	This machine should have a minimum of 2 GB of RAM and 200 GB hard drive
	storage space.
	The IRIS server does not have a GUI interface, so this computer can be
	set up headless.
</p>
<p>
	After the operating system is installed, make sure the hostname is
	configured correctly in DNS.
	The hostname is needed for some configuration files in the following
	steps.
	The following command should display the hostname that can be used to
	access the server:
</p>
<pre class="code">hostname -f</pre>

<h3 id="install_iris">Install IRIS</h3>
<p>
	<a href="http://iris.dot.state.mn.us/rpms/">Download</a> and install
	the IRIS package.
	This should be a file called
	<b>iris-<i>{major}</i>.<i>{minor}</i>.<i>{micro}</i>-<i>{build}</i>.<i>{arch}</i>.rpm</b>.
	The <i>{major}</i>, <i>{minor}</i>, and <i>{micro}</i> version numbers
	and the <i>{build}</i> number can change with each release.
	The system architecture, <i>{arch}</i>, will be <i>noarch</i>,
	since Java is architecture independent.
	It can be installed with the following command (as root):
</p>
<pre class="code">dnf install iris-<i>{major}</i>.<i>{minor}</i>.<i>{micro}</i>-<i>{build}</i>.noarch.rpm</pre>
<p>
	This will install dependencies not already installed, including
	<a href="http://openjdk.java.net">OpenJDK</a>,
	<a href="http://www.postgresql.org">PostgreSQL</a> and
	<a href="http://projects.apache.org/projects/http_server.html">Apache</a>.
</p>
<h3 id="init_iris">Initialize IRIS</h3>
<p>
	Next, you must initialize the IRIS server installation.
	Run the following command (as root):
</p>
<pre class="code">iris_ctl init</pre>
<p>
	This command will perform the following steps:
</p>
<ol>
	<li>
		Update the <code>/etc/iris/iris-client.properties</code> file
		with the server's hostname.
	</li>
	<li>
		Create an SSL key pair for encrypted communication between the
		server and clients.
		The keystore files are
		<code>/etc/iris/iris-server.keystore</code> and
		<code>/etc/iris/iris-client.keystore</code>.
		The keystore passwords are put into
		<code>/etc/iris/iris-server.properties</code> and
		<code>/etc/iris/iris-client.properties</code>.
	</li>
	<li>
		Create a symbolic link to the PostgreSQL JDBC driver to make it
		available to the IRIS server.
	</li>
	<li>
		Create the database cluster and start the PostgreSQL server.
	</li>
	<li>
		Create the "tms" PostgreSQL user, which IRIS uses to connect
		to the database.
	</li>
	<li>
		Create the "tms" database and populate it using a template
		SQL script.
	</li>
	<li>
		Configure the apache (httpd) and IRIS services to start
		automatically.
	</li>
	<li>
		Create symbolic links to the current IRIS software version.
	</li>
</ol>
<p>
	The command should finish with the following message:
</p>
<pre>Successfully initialized the IRIS server</pre>

<h3 id="server_properties">Server Properties</h3>
<p>
	The IRIS server has a configuration file which controls some of its
	basic settings &mdash; <i>/etc/iris/iris-server.properties</i>.
	Most of the default settings should work, but it may be necessary to
	make some changes.
	The file can be modified using a text editor, such as <i>gedit</i> or
	<i>vi</i>.
</p>
<h4>Internationalization</h4>
<p>
	There are three properties which control internationalization (i18n).
	They are <i>language</i>, <i>country</i> and <i>variant</i>.
	These should only be changed if the IRIS software has been localized
	for a specific locale.
</p>
<h4 id="district">District</h4>
<p>
	This property is used when multiple IRIS servers are running within the
	same organization.
</p>
<h4>HTTP Proxy</h4>
<p>
	These properties can be used when IRIS must connect to HTTP servers
	using a proxy server, due to organization firewall policies.
</p>
<h4>Database Connection</h4>
<p>
	The <i>db.url</i>, <i>db.user</i> and <i>db.password</i> properties
	control how the IRIS server connects to the PostgreSQL database.
	None of these properties should be changed, since they were configured
	earlier by the <code>iris_ctl</code> script.
</p>
<h4 id="sonar_config">SONAR Configuration</h4>
<p>
	The <i>sonar.ldap.urls</i> property can be used to let IRIS pass user
	authentication requests to one or more LDAP servers.
	Multiple URLs must be separated by a space.
	IRIS can manage user accounts and passwords without an LDAP server, but
	this feature allows operators to log into IRIS without requiring them to
	remember an additional user name and password.
	If your organization already has an LDAP server, such as Active
	Directory, you should use that.
</p>
<p>
	The URL protocol is normally <i>ldap:</i>, but must be <i>ldaps:</i>
	for encrypted communication over SSL.
	To use ldaps, you must first import the SSL certificate into the IRIS
	keystore.
	Once you have obtained the SSL certificate for the LDAP server, save it
	as <i>ldap.cert</i>.
	Now you can import it with the following command (as root):
</p>
<pre class="code">keytool -import -alias ldap-cert -keystore /etc/iris/iris-server.keystore -file ldap.cert</pre>
<p>
	The <i>keystore.password</i> is used for accessing keys in
	<code>/etc/iris/iris-server.keystore</code>.
	This password is automatically generated by the <code>iris_ctl</code>
	script.
	It will not need to be changed.
</p>

<h3 id="start_services">Start Services</h3>
<p>
	Finally, the IRIS server can now be started with the following command:
</p>
<pre class="code">systemctl start iris</pre>
<p>
	Check that everything started OK:
</p>
<pre class="code">tail /var/log/iris/iris.stderr
systemctl status iris</pre>
<p>
	This should indicate that IRIS is active and running.
	If the process is inactive (dead) with an exit status of 127, there
	may be a packaging problem with OpenJDK (seen on Fedora 24).
	The following command (followed by restarting IRIS) may work around this
	problem:
</p>
<pre class="code">ln -s /usr/lib/jvm/java-1.8.0/lib/amd64/jli/libjli.so /usr/lib64/</pre>

<h3 id="initial_login">Initial Login</h3>
<p>
	From a client computer with Java installed, point your web browser at
	http://YOUR_SERVER_NAME/iris-client/.
	From there, you should be able to launch the IRIS client Web Start
	application and log in.
</p>
<p>
	Enter <code>admin</code> as the username and <code>atms_242</code> as
	the password for the initial login.
	After <a href="#users_and_roles">creating</a> and logging in with a
	real administrator account, the <code>admin</code> user account should
	be disabled.
</p>

<h2 id="basic_setup">Basic Setup</h2>
<br/>

<h3 id="client_properties">Client Properties</h3>
<p>
	The IRIS server has a configuration file which contains default
	properties for clients &mdash; <i>/etc/iris/iris-client.properties</i>.
	These properties include internationalization, network proxy, and other
	system configuration.
	Note that even though IRIS has been internationalized, it has not yet
	been translated to languages other than english.
</p>
<dl>
	<dt>language</dt>
	<dd>
		ISO 639 alpha-2 or alpha-3 language code.
		E.g., "en", "es", "fr".
	</dd>
	<dt>country</dt>
	<dd>
		ISO 3166 alpha-2 country code or UN M.49 numeric-3 area code.
		E.g., "US", "MX", "CA".
	</dd>
	<dt>variant</dt>
	<dd>
		IETF BCP 47 language variant subtag.
	</dd>
	<dt>district</dt>
	<dd>
		District name.
		Useful in cases where multiple IRIS servers exist within the
		same organization.
	</dd>
	<dt>proxy.host</dt>
	<dd>
		If a proxy is to be used, its hostname can be specified here.
	</dd>
	<dt>proxy.port</dt>
	<dd>
		If a proxy is to be used, its port number can be specified here.
	</dd>
	<dt>no.proxy.hosts</dt>
	<dd>
		A comma-separated list of host IPs/subnets to exclude from proxy
		use.
	</dd>
	<dt>keystore.file</dt>
	<dd>
		URL for the client keystore file.
	</dd>
	<dt>keystore.password</dt>
	<dd>
		Password for the client keystore.
	</dd>
	<dt>sonar.host</dt>
	<dd>
		IP or hostname of the SONAR server.
	</dd>
	<dt>sonar.port</dt>
	<dd>
		TCP port number of the SONAR server.
	</dd>
	<dt>tdxml.detector.url</dt>
	<dd>
		URL for XML detector stream.
	</dd>
	<dt>map.tile.url</dt>
	<dd>
		Base URL for map tileset.
		Must end in "/".
	</dd>
	<dt>video.host</dt>
	<dd>
		IP or hostname of video server/proxy.
	</dd>
	<dt>video.port</dt>
	<dd>
		TCP port number of video server/proxy.
	</dd>
	<dt>video.extviewer</dt>
	<dd>
		External video viewer.
	</dd>
	<dt>autologin.username</dt>
	<dd>
		A username to be used for automatic login upon client startup.
		Note: use of this property is a security risk.
	</dd>
	<dt>autologin.password</dt>
	<dd>
		A password to be used for automatic login upon client startup.
		Note: use of this property is a security risk.
	</dd>
	<dt>tab.list</dt>
	<dd>
		A list specifying the visibility and ordering of the primary UI
		tabs in the IRIS client.
		The default value is:
		<code>incident, dms, camera, lcs, ramp.meter, gate.arm, r_node,
		      action.plan, comm</code>
	</dd>
	<dt>scale</dt>
	<dd>
		User interface scaling factor (0.25 to 4.0).
		Useful for Hi-DPI screens.
	</dd>
</dl>

<h3 id="user_properties">User Properties</h3>
<p>
	The IRIS client also reads a property file on client computers.
	The file is named "user.properties", and can be found in the "iris"
	folder of the user's home directory.
	It can contain overrides for any of the default values in the
	<a href="#client_properties">client properties</a> file.
	The file is overwritten when logging out.
	The window geometry and last selected tab will be updated,
	but all other properties will be left unchanged.
</p>

<h3 id="edit_mode">Edit Mode</h3>
<p>
	There is an <b>edit mode</b> toggle button on the lower-right corner of
	the IRIS client.
	When the edit mode is <b>OFF</b>, all configuration changes will be
	disallowed.
	This feature prevents administrators from accidentally modifying the
	system while looking up information.
	It is recommended to only turn the edit mode <b>ON</b> while updating
	the system configuration.
	Note: edit mode does not grant any capabilities which are not already
	associated with the <a href="#users_and_roles">user's role</a>.
</p>

<h3 id="system_attributes">System Attributes</h3>
<aside>
	Select <span class="menu">View ➔ System ➔ System Attributes</span> menu
	item
</aside>
<p>
	A <b>system attribute</b> is a configurable value which can be used to
	customize an IRIS system.
	Each system attribute has a corresponding type: string, boolean,
	integer or floating point number.
	String values are limited to 64 characters or less.
	Boolean values must be specified as either "true" or "false".
	Many numeric system attributes are constrained to a range of values
	within a minimum and maximum bound, depending on the attribute.
	A system attribute can be customized by updating the value in the table
	on the System Attributes form.
	When a system attribute has been modified from its default value, it
	will be displayed <b>in bold</b>.
	Most attribute changes take effect immediately, but some require the
	IRIS client or server to be restarted. Some System Attributes are
	described in more detail below.
</p>

<h4>map_segment_max_meters</h4>
<p>
	This is used for two distinct purposes: 1) specifying the maximum
	distance between adjacent stations to draw segments on the map and
	2) specifying the maximum distance from a station to another downstream
	station for associating density, speed, etc. data with a segment.
</p>

<h3 id="users_and_roles">Users and Roles</h3>
<aside>
	Select <span class="menu">View ➔ System ➔ Users and Roles</span>
	menu item
</aside>
<p>
	When a user logs into the IRIS system, the user is checked for validity.
	The user account must be enabled, and be assigned to an enabled
	<b>role</b> for a log in to succeed.
	If the user has a "distinguished name" (dn), then authentication is
	performed using <a href="#sonar_config">LDAP</a>.
	Otherwise, IRIS checks the password against the stored password hash
	for that user account.
</p>
<p>
	The template SQL database contains one administrator role, called
	<code>admin</code>.
	This role is assigned <b>capabilities</b> which allow unfettered access
	to the IRIS system.
	Other roles can be created by an administrator, to allow users with a
	specific set of capabilities, as needed.
	For example, there are capabilities defined for each of the main tabs
	on the user interface: camera_tab, dms_tab, lcs_tab, meter_tab, etc.
	Also, these capabilities can be disabled, preventing any user from
	having access to them.
	So, if a system does not contain any LCS devices, the lcs_tab capability
	could be disabled globally, to prevent that tab from appearing in the
	user interface for any users.
	WARNING: changes take effect immediately &mdash; if the user_admin
	capability is disabled or removed from the administrator role, the
	administrator will lose access to change roles and capabilities.
</p>

<h3 id="mapping">Mapping</h3>
<p>
	The IRIS client can use map tiles to display high-quality maps as a
	background layer.
	The map tiles are fetched from a web server on demand as the client map
	is panned and zoomed.
	The tiles can be generated from data downloaded from
	<a href="http://openstreetmap.org">OpenStreetMap</a>.
	The following instructions describe one method of generating the map
	tiles on Fedora 20.
</p>

<h4>Get planet file</h4>
<p>
	Download the latest planet file (about 32GB).
<pre class="code">wget http://planet.openstreetmap.org/planet/planet-latest.osm.bz2</pre>
</p>

<h4>Download and install PostGIS</h4>
<p>
<pre class="code">sudo dnf install postgis postgis-docs postgis-utils</pre>
</p>

<h4>Configure PostGIS and create spatial DB</h4>
<p>
<pre class="code">
# Create DB named gis
su - postgres
createdb --encoding=UTF8 gis
psql -d gis -f /usr/share/pgsql/contrib/postgis-64.sql

# Edit kernel parameters to increase max size of shared memory
sudo sysctl -w kernel.shmmax=268435456
sudo sysctl -p /etc/sysctl.conf
sysctl -a | grep kernel.shmmax

# Update postgresql config
vim /var/lib/pgsql/data/postgresql.conf
	checkpoint_segments = 20
	maintenance_work_mem = 256MB # 256000 for 8.1 and earlier
	autovacuum = off
	shared_buffers = 4GB
	temp_buffers = 128MB
	maintenance_work_mem = 4GB
service postgresql restart
</pre>
</p>

<h4>Build and install osm2pgsql from source</h4>
<p>
<pre class="code">
su - tms
sudo dnf -y install git
sudo dnf -y install geos-devel proj-devel postgresql-devel libxml2-devel bzip2-devel
sudo dnf -y install gcc-c++ protobuf-c-devel autoconf automake libtool
mkdir ~/osm; cd ~/osm
git clone https://github.com/openstreetmap/osm2pgsql.git
cd ~/osm/osm2pgsql
./autogen.sh
./configure
make
sudo make install
</pre>
</p>

<h4>Import OSM planet file into PostGIS</h4>
<p>
	This process takes a long time (around 30 hours). See performance comparisons
	<a href="http://wiki.openstreetmap.org/wiki/Osm2pgsql/benchmarks">here</a>.
	Determine the bounding box for the region of interest. For Minnesota it
	is: -97.5, 43.0, -89.0, 49.5.
</p>
<pre class="code">
su - postgres
osm2pgsql -v --number-processes=16 -d gis -s --bbox -97.5, 43.0, -89.0, 49.5 planet-140522.osm.bz2
</pre>


<h4>Build and install mapnik library from source</h4>
<p>
	See the mapnik <a href="https://github.com/mapnik/mapnik/wiki/Mapnik-Installation">install docs</a>. The <a href="https://gist.github.com/springmeyer/3427021">Springmeyer docs</a> are also very useful.
</p>
<pre class="code">
su - tms
# Install dependencies
sudo dnf -y install make gcc47 gcc-c++ bzip2-devel libpng-devel libtiff-devel \
      zlib-devel libjpeg-devel libxml2-devel python-setuptools git-all \
      python-nose python27-devel python27 proj-devel proj proj-epsg \
      proj-nad freetype-devel freetype libicu-devel libicu
# Install optional deps
sudo dnf -y install gdal-devel gdal postgresql-devel sqlite-devel sqlite \
      libcurl-devel libcurl cairo-devel cairo pycairo-devel pycairo
# Build recent version of Boost
export JOBS=`grep -c ^processor /proc/cpuinfo`
mkdir -p ~/osm/src; cd ~/osm/src
export BOOST_VERSION="1_55_0"
export S3_BASE="http://mapnik.s3.amazonaws.com/deps"
curl -O ${S3_BASE}/boost_${BOOST_VERSION}.tar.bz2
tar xf boost_${BOOST_VERSION}.tar.bz2
cd boost_${BOOST_VERSION}
./bootstrap.sh
./b2 -d1 -j${JOBS} \
    --with-thread \
    --with-filesystem \
    --with-python \
    --with-regex -sHAVE_ICU=1  \
    --with-program_options \
    --with-system \
    link=shared \
    release \
    toolset=gcc \
    stage
sudo ./b2 -j${JOBS} \
    --with-thread \
    --with-filesystem \
    --with-python \
    --with-regex -sHAVE_ICU=1 \
    --with-program_options \
    --with-system \
    toolset=gcc \
    link=shared \
    release \
    install
cd ~/osm/src
# Set up support for libraries installed in /usr/local/lib
sudo bash -c "echo '/usr/local/lib' > /etc/ld.so.conf.d/boost.conf"
sudo ldconfig
# Build and install mapnik stable branch: 2.3.x
mkdir -p ~/osm/src; cd ~/osm/src
git clone https://github.com/mapnik/mapnik -b 2.3.x
cd ~/osm/src/mapnik
./configure
make
make test-local
sudo make install
# Verify everything is good
echo “import mapnik” | python
</pre>

<h4>Install mapnik tools</h4>
<p>
	See <a href="https://github.com/mapnik/mapnik/blob/v2.2.0/INSTALL.md">docs</a>.
</p>
<pre class="code">
sudo dnf -y install svn
cd ~/osm
svn export http://svn.openstreetmap.org/applications/rendering/mapnik
# Install prepared world boundary data
cd ~/osm/mapnik
mkdir world_boundaries
wget http://tile.openstreetmap.org/world_boundaries-spherical.tgz
tar xvzf world_boundaries-spherical.tgz
wget http://tile.openstreetmap.org/processed_p.tar.bz2
tar xvjf processed_p.tar.bz2 -C world_boundaries
wget http://tile.openstreetmap.org/shoreline_300.tar.bz2
tar xjf shoreline_300.tar.bz2 -C world_boundaries
wget http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_populated_places.zip
unzip ne_10m_populated_places.zip -d world_boundaries
wget http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/cultural/ne_110m_admin_0_boundary_lines_land.zip
unzip ne_110m_admin_0_boundary_lines_land.zip  -d world_boundaries
</pre>

<h4>Patch osm.xml to create iris_osm.xml</h4>
<pre class="code">
cd ~/osm/mapnik/
cp osm.xml iris_osm.xml
patch -p0 &lt; ../01_drop_junc_power_layers.patch
patch -p0 &lt; ../02_interstate_shields.patch
patch -p0 &lt; ../03_trunk_shields.patch
patch -p0 &lt; ../04_cty_rd_shields.patch
patch -p0 &lt; ../05_motorway_color.patch
patch -p0 &lt; ../06_trunk_color.patch
patch -p0 &lt; ../07_primary_color.patch
patch -p0 &lt; ../08_secondary_color.patch
patch -p0 &lt; ../09_tertiary_color.patch
</pre>

<h4>Copy symbols used for roadway shields</h4>
<p>
	FIXME
</p>

<h4>Generate tiles</h4>
<p>
	Generating tiles takes about 2 hours on a 16 processor system, or about 13K tiles/min.
</p>
<pre class="code">
su - tms
cd ~/osm/mapnik
export MAPNIK_MAP_FILE=~/osm/mapnik/iris_osm.xml
export MAPNIK_TILE_DIR=/home/tms/osm/tiles
# Customize osm.xml
./generate_xml.py  --dbname gis --accept-none
vim generate_tiles_multiprocess.py
	NUM_THREADS = number of processors in your server
	bbox = (-97.5, 43.0, -89.0, 49.5)
	minZoom = 6
	maxZoom = 16
	# comment all of the european cities listed
timer ./generate_tiles_multiprocess.py
# Copy tiles to server hosting them
scp -rp ~/osm/tiles/* root@tilehost:/var/www/html/
</pre>

<h4>Create Map Extents in IRIS database</h4>
<aside>
	Select <span class="menu">View ➔ System ➔ Map Extents</span> menu item
</aside>
<p>
	This form enables the creation of map extents, which are buttons
	allowing quick selection of a map location and zoom level.
	Each map extent will be displayed as a button on the upper right area
	of the map (next to the zoom in/out buttons).
	First, a "Home" extent should be created, which is selected by default
	when a user logs in.
	Other extents can also be created for commonly selected map spots.
</p>

<h3 id="road_topology">Road Topology</h3>
<figure>
<svg class="right" width='240' height='480'
     xmlns="http://www.w3.org/2000/svg" version="1.1"
     xmlns:xlink='http://www.w3.org/1999/xlink'>
  <title>R_Nodes</title>
<defs>
  <g id='r_node_marker' style='fill:lime;stroke:black;stroke-width:2'>
    <circle cx='0' cy='0' r='10'/>
    <path d='M-8-8L8 8'/>
    <path d='M-8 8L8-8'/>
  </g>
</defs>
<path d='M6 0L6 480 120 480 120 406C124 408 128 432 172 480L236 480
	 C196 448 150 368 120 288L120 208C128 168 214 50 236 0L172 0
	 C168 12 120 80 120 88L120 0Z'/>
<path style='fill:none;stroke:white;stroke-dasharray:10,20;stroke-width:4'
      d='M64 8L64 480'/>
<path style='fill:none;stroke:yellow;stroke-width:4'
      d='M16 0L16 480M112 368C118 404 168 468 180 480M180 0
	 C180 8 128 80 112 120'/>
<path style='fill:none;stroke:white;stroke-width:4'
      d='M112 0L112 122M228 0C196 64 145 128 112 200L112 288
	 C144 373 189 448 228 480M112 368L112 480'/>
<use x='112' y='32' xlink:href='#r_node_marker'/>
<use x='112' y='120' xlink:href='#r_node_marker'/>
<use x='112' y='240' xlink:href='#r_node_marker'/>
<use x='112' y='368' xlink:href='#r_node_marker'/>
<use x='112' y='448' xlink:href='#r_node_marker'/>
<text style="font-size:24px">
  <tspan x="128" y="248">R_Nodes</tspan>
</text>
</svg>
</figure>

<p>
	For many of the <a href="#features">features</a> IRIS provides, a model
	of the road network topology is required.
	This model consists of a set of roadway nodes, or <b>r_node</b>s, which
	describe all the points of interest on the road network.
	For instance, each entrance or exit ramp, detector station or
	intersection would be represented by an r_node.
</p>
<p>
	All r_nodes with the same road and direction-of-travel are grouped into
	<b>corridors</b>.
	The r_nodes within a corridor are automatically sorted based on their
	coordinates.
	Corridors are linked to each other by exit and entrance r_nodes.
	For example an exit r_node from Northbound road A to Eastbound road B
	would automatically link to an entrance onto Eastbound road B from
	Northbound road A.
</p>
<h4>Road Setup</h4>
<aside>
	Select <span class="menu">View ➔ System ➔ Roads</span> menu item
</aside>
<p>
	Before creating r_nodes, some roads must be created.
	With <a href="#edit_mode">edit mode</a> <b>ON</b>, enter the road name
	into the text box at the bottom of the form and press the <b>Create</b>
	button.
	Road names must be unique, and can be up to 20 characters in length.
	It's a good idea to capitalize each word, and abbreviate any
	designators — for example, "Main St".
</p>
<p>
	When a road is created, it will be added to the Roads table.
	Other road attributes can be changed here.
	The second column is <b>Abbrev</b>, which is an abbreviation of the
	road name (up to 6 characters).
	This is used for labeling detectors and stations.
</p>
<p>
	The <b>Road Class</b> determines the presentation of the road on the
	map.
	For example, a road marked "Freeway" would be drawn thicker and more
	prominent than an "Expressway" or "Arterial".
</p>
<p>
	<b>Direction</b> and <b>Alt Dir</b> determine the primary and secondary
	compass directions of the road.
</p>
<h4 id="r_node">R_Node Location</h4>
<p>
	Select the <b>R_Nodes</b> tab on the client interface to create or
	edit r_nodes.
	In the <b>Selected Roadway Corridor</b> frame, there is an <b>Add</b>
	button.
	Press the button to start creating a new r_node.
	The mouse cursor will change to a <b>target</b> while over the map.
	Select the point on the map where the r_node should be located and
	left-click the mouse.
	The new r_node will appear on the map, and in the list for the
	selected corridor.
</p>
<p>
	In the <b>Selected Roadway Corridor</b> frame, there is a
	<b>Corridor</b> widget containing a list of all corridors which
	contain at least one r_node.
	When a corridor is selected, the r_node list will be populated with all
	r_nodes on the corridor.
	Also, any new r_nodes created will be on the selected corridor.
</p>
<p>
	Once an r_node is selected, any fields on the <b>Location</b> tab can
	be edited.
	Changing the roadway or direction will move the r_node to another
	corridor.
	Other attributes are nearest cross-street, cross-street direction,
	and notes.
</p>
<h4>R_Node Setup</h4>
<p>
	The r_node <b>Setup</b> tab contains several more attributes.
</p>
<dl>
  <dt id='r_node_type'>node_type</dt>
  <dd>There are six different r_node types:
    <table>
      <tr>
        <th>Code</th>
        <th>Node Type</th>
        <th>Description</th>
      </tr>
      <tr>
        <td>0</td>
        <td>station</td>
        <td>Mainline detector station or shape node</td>
      </tr>
      <tr>
	<td>1</td>
	<td>entrance</td>
	<td>Entrance ramp onto corridor</td>
      </tr>
      <tr>
	<td>2</td>
	<td>exit</td>
	<td>Exit ramp off corridor</td>
      </tr>
      <tr>
	<td>3</td>
	<td>intersection</td>
	<td>At-grade intersection with another corridor</td>
      </tr>
      <tr>
	<td>4</td>
	<td>access</td>
	<td>Network access (for traveler information)</td>
      </tr>
      <tr>
	<td>5</td>
	<td>interchange</td>
	<td>Freeway interchange (for traveler information)</td>
      </tr>
    </table>
  </dd>
  <dt id='r_node_transition'>transition</dt>
  <dd>An r_node transition describes how entrance or exit nodes connect with
      linked nodes.
    <table>
      <tr>
	<th>Code</th>
	<th>Transition</th>
	<th>Description</th>
      </tr>
      <tr>
	<td>0</td>
	<td>none</td>
	<td>No transition &mdash; non-entrance or -exit r_nodes</td>
      </tr>
      <tr>
	<td>1</td>
	<td>loop</td>
	<td>Interchange loop ramp &mdash; "leaf" part of cloverleaf</td>
      </tr>
      <tr>
	<td>2</td>
	<td>leg</td>
	<td>Typical "leg" ramp</td>
      </tr>
      <tr>
	<td>3</td>
	<td>slipramp</td>
	<td>Transition ramp between parallel corridors</td>
      </tr>
      <tr>
	<td>4</td>
	<td>CD</td>
	<td>Transition to/from collector/distributor road</td>
      </tr>
      <tr>
	<td>5</td>
	<td>HOV</td>
	<td>Bypass ramp for high-occupancy-vehicles</td>
      </tr>
      <tr>
	<td>6</td>
	<td>common</td>
	<td>Common section joining two corridors</td>
      </tr>
      <tr>
	<td>7</td>
	<td>flyover</td>
	<td>Flyover ramp (bridge over mainline)</td>
      </tr>
    </table>
  </dd>
  <dt>lanes</dt>
  <dd>Number of lanes at r_node.
      For a ramp node, this is the number of lanes entering or exiting the
      mainline.
  </dd>
  <dt>shift</dt>
  <dd>Lane shift is the difference (number of lanes) between the corridor
      reference lane and the attach side of the r_node.
      This value is used for lane continuity analysis within a corridor.
      Each corridor has a reference lane, which corresponds to the leftmost
      lane along the entire corridor.
  </dd>
  <dt>station_id</dt>
  <dd>The station_id is a unique identifier for the detectors associated with
      the r_node.
      It is displayed on the <a href="#traffic_layer">traffic layer</a>, and is
      also used for identifying travel time destinations.
  </dd>
  <dt>speed_limit</dt>
  <dd>This is the posted speed limit at the r_node.
      The units are miles per hour, but should in future be dependent on locale
      (KPH).
      For ramp r_nodes, it may be used to indicate the advisory speed limit on
      the ramp.
      The limit is used in travel time estimation.
  </dd>
  <dt>pickable</dt>
  <dd>For deploying <a href="#dms">DMS</a> from <a href="#inc_locator">
      incidents</a>, an r_node can be marked pickable if the road name should be
      used on the sign message.
  </dd>
  <dt>above</dt>
  <dd>When rendering the <a href="#traffic_layer">traffic layer</a>, r_nodes are
      rendered in two passes.
      The second pass consists of r_nodes which have been marked <b>above</b>.
      This prevents overpasses from being drawn incorrectly.
  </dd>
  <dt>attach_side</dt>
  <dd>This flag indicates whether the r_node is attached to the left side of
      the road.
      This can be used to create left entrance or exit ramps.
  </dd>
  <dt>active</dt>
  <dd>This flag allows an r_node to be deactivated.  An inactive r_node will
      not be included in any corridor or drawn on the
      <a href="#traffic_layer">traffic layer</a>.
  </dd>
</dl>
<h4>R_Node Detectors</h4>
<p>
	The r_node <b>Detectors</b> tab allows vehicle
	<a href="#vds">detectors</a> to be created and associated
	with an r_node.
</p>

<h3 id="comm_links">Comm Links</h3>
<aside>
	Select <span class="menu">View ➔ Maintenance ➔ Comm Links</span> menu
	item
</aside>
<p>
	A <b>comm link</b> is a network connection to an external device or
	system.
	IRIS is capable of supporting hundreds of simultaneous comm links.
	Each comm link has a number of attributes, including URI and protocol.
</p>
<p>
	The URI includes a DNS host name or network IP address, and port number,
	using the standard "host:port" convention.
	The URI can also contain an optional "scheme" prefix, which can be
	either "udp://", "tcp://" or "modem://".
	If present, the scheme will override the default URI scheme for the
	selected protocol.
	For example, to use the Pelco D protocol over TCP (instead of the
	default UDP), add a "tcp://" scheme prefix to the URI.
</p>
<p>
	The protocol determines what type of device or system is on the other
	end of the comm link.
	The following table contains the communication protocols supported by
	IRIS.
</p>
<table>
	<tr>
	    <th>Protocol</th>
	    <th>Description</th>
	    <th>Default Scheme</th>
	</tr>
	<tr>
	    <td>NTCIP Class A</td>
	    <td><a href="#dms">DMS</a> control,
	        <a href="#ilcs">ILCS</a> (no HDLC)
	    </td>
	    <td>UDP</td>
	</tr>
	<tr>
	    <td>NTCIP Class B</td>
	    <td><a href="#dms">DMS</a> control,
	        <a href="#ilcs">ILCS</a> over serial (HDLC)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>NTCIP Class C</td>
	    <td><a href="#dms">DMS</a> control,
	        <a href="#ilcs">ILCS</a> (no HDLC)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>DMS XML</td>
	    <td><a href="#dms">DMS</a> control to external system</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Addco NodeComm</td>
	    <td><a href="#dms">DMS</a> control</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Msg feed</td>
	    <td><a href="#msg_feed">DMS messages</a> from external system</td>
	    <td>TCP / HTTP</td>
	</tr>
	<tr>
	    <td>MnDOT 170 4</td>
	    <td><a href="#vds">VDS</a>,
	        <a href="#ramp_meters">metering</a>,
	        <a href="#dlcs">DLCS</a>,
		<a href="#beacons">beacons</a>,
		<a href="#alarms">alarms</a>
	    </td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>MnDOT 170 5</td>
	    <td><a href="#vds">VDS</a>,
	        <a href="#ramp_meters">metering</a>,
	        <a href="#dlcs">DLCS</a>,
		<a href="#beacons">beacons</a>,
		<a href="#alarms">alarms</a>
	    </td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Canoga</td>
	    <td><a href="#vds">VDS</a> (GTT Canoga Traffic Sensing System)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>SS105</td>
	    <td><a href="#vds">VDS</a> (original Wavetronix SmartSensor)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>SS125</td>
	    <td><a href="#vds">VDS</a> (Wavetronix SmartSensor HD)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>RTMS G4</td>
	    <td><a href="#vds">VDS</a> (RTMS G4 sensor)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Pelco D</td>
	    <td><a href="#ptz">PTZ</a> for Pelco cameras</td>
	    <td>UDP</td>
	</tr>
	<tr>
	    <td>Manchester</td>
	    <td><a href="#ptz">PTZ</a> for AD cameras</td>
	    <td>UDP</td>
	</tr>
	<tr>
	    <td>Vicon</td>
	    <td><a href="#ptz">PTZ</a> for Vicon cameras</td>
	    <td>UDP</td>
	</tr>
	<tr>
	    <td>Infinova</td>
	    <td><a href="#ptz">PTZ</a> for Infinova cameras</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Cohu</td>
	    <td><a href="#ptz">PTZ</a> for Cohu cameras</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>STC</td>
	    <td><a href="#gate_arms">Gate Arm</a> control for HySecurity
	        SmartTouch Controllers
	    </td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>E6</td>
	    <td><a href="#tag_readers">Tag Reader</a> (Transcore E6)</td>
	    <td>UDP</td>
	</tr>
	<tr>
	    <td>Pelco Switcher</td>
	    <td><a href="#video">Video switching</a> for Pelco</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Org 815</td>
	    <td><a href="#rwis">RWIS</a> (ORG 815 sensor)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>SSI</td>
	    <td><a href="#rwis">RWIS</a> (SSI RWIS sensor)</td>
	    <td>TCP / HTTP</td>
	</tr>
	<tr>
	    <td><a href="#din_relay">DLI DIN Relay</a></td>
	    <td><a href="#dlcs">DLCS</a>, <a href="#beacons">beacons</a></td>
	    <td>TCP / HTTP</td>
	</tr>
	<tr>
	    <td><a href="#cbw">Control By Web</a></td>
	    <td><a href="#beacons">beacons</a></td>
	    <td>TCP / HTTP</td>
	</tr>
	<tr>
	    <td>Incident feed</td>
	    <td><a href="#inc_feed">Incidents</a> from external system</td>
	    <td>TCP / HTTP</td>
	</tr>
</table>
<p/>

<h4 id="msg_feed">DMS Msg Feed Protocol</h4>
<p>
	The "msg feed" protocol can be used to interface IRIS with an external
	system that generates <a href="#dms">DMS</a> messages.
	Periodically, IRIS will poll the URI (using HTTP) for DMS messages.
	The external system should respond with an ASCII text file, with one
	line per message to be deployed.
</p>
<p>
	Each line must contain 3 fields, separated by tab characters "\t"
	(ASCII 0x09), and terminated with a single newline character "\n"
	(ASCII 0x0A).
	The fields are DMS name, <a href="#multi">MULTI</a> string, and
	expiration time.
	The DMS name must exactly match one of the DMS as identified by IRIS.
	The MULTI string specifies a message to display on the sign, using the
	MULTI markup language, from NTCIP 1203.
	For example, "ROAD CLOSED[nl]AHEAD[nl]LEFT LANE CLOSED" is a valid
	three-line MULTI message.
	The expiration field indicates the date and time that the message
	should expire.
	It is in "yyyy-MM-dd HH:mm:ssZ" format, which includes date, time and
	time zone.
	A valid expiration time would be 2012-05-15 11:37:00-0600.
</p>
<p>
	There are a couple of other required steps to enable a message feed
	to operate.
	First, an <a href="#action_plans">action plan</a> must be created which
	associates a <a href="#dms_actions">DMS action</a> with the message
	feed.
	The DMS action must be associated with a <a href="#quick_msg">quick
	message</a> that references the message feed, using a <b>feed</b>
	<a href="#action_tag">action tag</a>.
	So, if the message feed is on a Comm Link called "LFEED", then the
	quick message MULTI string must be "[feedLFEED]".
	Also, the action plan must be active and deployed.
	This requirement allows only administrator-approved DMS to be controlled
	by the message feed.
</p>
<p>
	The other requirement for message feeds is that all messages used by
	the feed must be defined in the DMS message library.
	This requirement allows only administrator-approved messages to be
	deployed by the message feed.
	In some circumstances, it may be appropriate to disable this checking.
	For example, if the message feed host is fully trusted and there is no
	possibility of man-in-the-middle attacks between IRIS and the feed host.
	In this case the <code>msg_feed_verify</code>
	<a href="#system_attributes">system attribute</a> can be set to
	<code>false</code> to disable this check.
</p>

<h4 id="din_relay">DIN Relay</h4>
<p>
	DIN relay is a product by DLI which allows simple devices to be turned
	on of off through an HTTP (web) interface.
	Each device can control up to 8 outlets, which for a
	<a href="#dlcs">DLCS</A> means 2 lanes with 3 indications each.
</p>

<h4 id="cbw">Control By Web</h4>
<p>
	Control By Web is a web-based relay controller made by Xytronix.
	It can be used to control <a href="#beacons">beacon</a> devices.
</p>
<p>
	HTTP Basic Authentication can be used to connect with the controller
	if enabled on the setup page of the device (setup.html).
	To allow IRIS to authenticate, the password field of the controller
	in IRIS must have <i>none:</i> prepended to the actual password.
</p>

<h4 id="inc_feed">Incident Feed Protocol</h4>
<p>
	The "inc feed" protocol can be used to interface IRIS with an external
	system that generates <a href="#incident_management">incidents</a>.
	Periodically, IRIS will poll the URI (using HTTP) for incidents.
	The external system should respond with an ASCII text file, with one
	line per active incident.
</p>
<p>
	Each line should contain 6 fields, separated by comma characters ","
	and terminated with a single newline character "\n" (ASCII 0x0A).
	The fields are incident ID, type, incident detail, latitude, longitude,
	and camera ID.
	The type must be CRASH, STALL, ROADWORK, or HAZARD.
	The detail may be blank, or one of the incident detail names.
	Latitude and longitude must be coordinates of the incident.
	Camera ID may be blank, or the ID of a camera to view the incident.
</p>

<h3 id="controllers">Controllers</h3>
<aside>
	Select <span class="menu">View ➔ Maintenance ➔ Comm Links</span> menu
	item
</aside>
<p>
	A <b>controller</b> is an end-point for a <a href="#comm_links">comm
	link</a>.
	Each controller can have one or more associated <a href="#devices">
	devices</a>, depending on the protocol.
	Sometimes a controller represents a separate physical "box", which is
	connected to devices, and other times the controller may be embedded
	within the device.
	In any case, IRIS requires a controller for any communication to a
	device.
	Controllers can be assigned to a <b>cabinet</b>, which has location
	information, to allow displaying on a map.
</p>

<h4 id="drop_address">Drop Address</h4>
<p>
	Some protocols support <b>multi-drop</b> addressing, and others are
	<b>single-drop</b> only.
	Multi-drop addressing allows multiple controllers to share the same
	comm link.
	It is typically used with serial communication protocols.
	Each controller is assigned a unique (to the comm link) drop address,
	which is used to route all messages sent to the controller.
	For single-drop protocols, the drop address is ignored.
</p>

<h4 id="io_pins">I/O Pins</h4>
<p>
	Each controller has a set of <b>I/O pins</b>, to which
	<a href="#devices">devices</a> can be assigned.
	The function of these pins is protocol specific &mdash; see the
	following table.
</p>
<table>
	<tr>
	    <th>Device Type</th>
	    <th>Protocol</th>
	    <th>I/O Pin(s)</th>
	</tr>
	<tr>
	    <td><a href="#dms">DMS</a>, <a href="#ilcs">ILCS</a></td>
	    <td>NTCIP (A, B, C), DMS XML, Addco</td>
	    <td>1</td>
	</tr>
	<tr>
	    <td rowspan="2"><a href="#dlcs">DLCS</a></td>
	    <td>MnDOT 170 (4, 5)</td>
	    <td>19 - 36</td>
	</tr>
	<tr>
	    <td><a href="#din_relay">DIN Relay</a></td>
	    <td>1 - 8</td>
	</tr>
	<tr>
	    <td><a href="#cameras">Camera</a></td>
	    <td>Pelco D, Manchester, Vicon, Infinova, Cohu</td>
	    <td>1</td>
	</tr>
	<tr>
	    <td rowspan="4"><a href="#vds">VDS</a></td>
	    <td>MnDOT 170 (4, 5)</td>
	    <td>39 - 62</td>
	</tr>
	<tr>
	    <td>Canoga</td>
	    <td>1 - 4</td>
	</tr>
	<tr>
	    <td>SS105, SS125</td>
	    <td>1 - 8</td>
	</tr>
	<tr>
	    <td>RTMS G4</td>
	    <td>1 - 12</td>
	</tr>
	<tr>
	    <td><a href="#ramp_meters">Ramp Meter</a></td>
	    <td>MnDOT 170 (4, 5)</td>
	    <td>2 or 3</td>
	</tr>
	<tr>
	    <td><a href="#gate_arms">Gate Arm</a></td>
	    <td>STC</td>
	    <td>1</td>
	</tr>
	<tr>
	    <td><a href="#tag_readers">Tag Reader</a></td>
	    <td>E6</td>
	    <td>1</td>
	</tr>
	<tr>
	    <td rowspan="3"><a href="#beacons">Beacon</a></td>
	    <td>MnDOT 170 (4, 5)</td>
	    <td>2</td>
	</tr>
	<tr>
	    <td><a href="#din_relay">DIN Relay</a></td>
	    <td>1 - 8</td>
	</tr>
	<tr>
	    <td><a href="#cbw">CBW</a></td>
	    <td>1 - 8</td>
	</tr>
	<tr>
	    <td><a href="#rwis">RWIS</a></td>
	    <td>Org 815, SSI</td>
	    <td>1</td>
	</tr>
	<tr>
	    <td><a href="#video">Video Switcher</a></td>
	    <td>Pelco</td>
	    <td>1</td>
	</tr>
</table>
<br/>

<h3 id="fonts">Fonts</h3>
<aside>
	Select <span class="menu">View ➔ Message Signs ➔ DMS Fonts</span> menu
	item
</aside>
<p>
	A font is a set of bitmapped glyphs for displaying text on a dynamic
	message sign (DMS).
	Each font can contain any of the printable characters in the ASCII
	character set (0x20 to 0x7E).
</p>
<p>
	When selecting a font, a few parameters must be considered, such as
	pixel pitch, desired character height, and font weight.
	Pixel pitch can vary from 66 mm down to 20 mm or smaller.
	Typically, for freeway signs, characters should be between 350 and 400
	mm (about 14 or 15 inches) high.
	See the table below for character heights based on these common sizes.
</p>
<table>
	<tr>
	    <th rowspan='2'>Font Height</th>
	    <th colspan='4'>Pixel Pitch</th>
	</tr>
	<tr>
	    <th>20 mm</th>
	    <th>33 mm</th>
	    <th>50 mm</th>
	    <th>66 mm</th>
	</tr>
	<tr>
	    <th>7 px</th>
	    <td>120 mm</td>
	    <td>198 mm</td>
	    <td>300 mm</td>
	    <td class='best'>396 mm</td>
	</tr>
	<tr>
	    <th>8 px</th>
	    <td>140 mm</td>
	    <td>231 mm</td>
	    <td class='best'>350 mm</td>
	    <td>462 mm</td>
	</tr>
	<tr>
	    <th>10 px</th>
	    <td>180 mm</td>
	    <td>297 mm</td>
	    <td>450 mm</td>
	    <td>594 mm</td>
	</tr>
	<tr>
	    <th>12 px</th>
	    <td>220 mm</td>
	    <td class='best'>363 mm</td>
	    <td>550 mm</td>
	    <td>726 mm</td>
	</tr>
	<tr>
	    <th>14 px</th>
	    <td>260 mm</td>
	    <td>429 mm</td>
	    <td>650 mm</td>
	    <td>858 mm</td>
	</tr>
	<tr>
	    <th>16 px</th>
	    <td>300 mm</td>
	    <td>495 mm</td>
	    <td>750 mm</td>
	    <td>990 mm</td>
	</tr>
	<tr>
	    <th>18 px</th>
	    <td>340 mm</td>
	    <td>561 mm</td>
	    <td>850 mm</td>
	    <td>1122 mm</td>
	</tr>
	<tr>
	    <th>20 px</th>
	    <td class='best'>380 mm</td>
	    <td>627 mm</td>
	    <td>950 mm</td>
	    <td>1254 mm</td>
	</tr>
</table>
<p>
	In the past, DMS have been used with upper-case only fonts, but with
	smaller pixel pitch, it is possible to create legible fonts which
	also include lower-case characters.
	If a message containing lower-case characters is used with an upper-case
	only font, IRIS will replace those characters with their equivalent.
</p>
<p>
	Fifteen fonts are included in the IRIS template SQL script.
	These fonts are designed to have a similar visual style.
</p>
<table>
	<tr>
	    <th>Number</th>
	    <th>Font Name</th>
            <th>Description</th>
	</tr>
	<tr>
	    <td>1</td>
	    <td>07_char</td>
	    <td>7x5 character matrix</td>
	</tr>
	<tr>
	    <td>2</td>
	    <td>07_line</td>
	    <td>7 pixel high line-matrix</td>
	</tr>
	<tr>
	    <td>3</td>
	    <td>08_full</td>
	    <td>8 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>4</td>
	    <td>09_full</td>
	    <td>9 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>5</td>
	    <td>10_full</td>
	    <td>10 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>6</td>
	    <td>11_full</td>
	    <td>11 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>7</td>
	    <td>12_full</td>
	    <td>12 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>8</td>
	    <td>12_full_bold</td>
	    <td>12 pixel high full-matrix bold</td>
	</tr>
	<tr>
	    <td>9</td>
	    <td>13_full</td>
	    <td>13 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>11</td>
	    <td>14_full</td>
	    <td>14 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>13</td>
	    <td>16_full</td>
	    <td>16 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>14</td>
	    <td>18_full</td>
	    <td>18 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>15</td>
	    <td>20_full</td>
	    <td>20 pixel high full-matrix (numerals only)</td>
	</tr>
	<tr>
	    <td>16</td>
	    <td>24_full</td>
	    <td>24 pixel high full-matrix (numerals only)</td>
	</tr>
	<tr>
	    <td>17</td>
	    <td>_09_full_12</td>
	    <td>9 pixel high (12 with lower case descenders)</td>
	</tr>
</table>
<p>
	The IRIS client also contains a font editor which can be used to design
	new DMS fonts.
</p>

<h2 id="devices">Devices</h2>
<p>
	A device is a hardware field control or sensing system.
	IRIS supports several different device types:
	<a href="#dms">dynamic message signs</a>,
	<a href="#cameras">cameras</a>,
	<a href="#vds">vehicle detection</a>,
	<a href="#lcs">lane-use control signs</a>,
	<a href="#ramp_meters">ramp meters</a>,
	<a href="#gate_arms">gate arms</a>,
	<a href="#tag_readers">tag readers</a>,
	<a href="#beacons">beacons</a>,
	<a href="#alarms">alarms</a>,
	<a href="#rwis">road weather information systems</a>, and
	<a href="#lane_marking">lane marking</a>.
</p>
<p>
	For any device to be activated, it must first be connected to one of the
	<a href="#io_pins">I/O pins</a> on a
	<a href="#controllers">controller</a>.
	The controller must also be associated with a
	<a href="#comm_links">comm link</a> which communicates using the
	appropriate protocol for the device.
</p>

<h3 id="dms">Dynamic Message Signs (DMS)</h3>
<aside>
	Select <span class="menu">View ➔ Message Signs ➔ DMS</span> menu item
</aside>
<p>
	A dynamic message sign (DMS) is a sign which is capable of changing the
	message displayed to motorists.
	They can be classified as character-matrix, line-matrix and full-matrix,
	depending on the spacing between pixels.
	Some are monochrome, and some support full color display.
	All of these configurations are supported by IRIS.
</p>
<p>
	The following operations can be performed on a DMS:
</p>
<ul>
	<li>Querying currently displayed message</li>
	<li>Displaying new messages</li>
	<li>Querying configuration information</li>
	<li>Querying diagnostic information</li>
	<li>Sending fonts and graphics</li>
</ul>

<h4>DMS Setup</h4>
FIXME

<h4 id="multi">MULTI (Markup Language for Transportation Information)</h4>
<p>
	DMS messages are specified using <b>MULTI</b>, as defined by the
	NTCIP 1203 standard.
	In MULTI, messages are simple ASCII strings, with formatting or other
	instructions denoted by tags inside square brackets.
	For example, the tag <code>[nl]</code> indicates a new line.
	Most of the useful MULTI tags are supported.
</p>
<table>
	<tr>
	    <th>Tag</th>
	    <th>Description</th>
	    <th>Supported</th>
	</tr>
	<tr>
	    <td>[cb<i>x</i>]</td>
	    <td>Message background color</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[pb<i>z</i>]</td>
	    <td rowspan="2">Page background color</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[pb<i>r</i>,<i>g</i>,<i>b</i>]</td>
	</tr>
	<tr>
	    <td>[cf<i>x</i>]</td>
	    <td rowspan="2">Foreground color</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[cf<i>r</i>,<i>g</i>,<i>b</i>]</td>
	</tr>
	<tr>
	    <td>[cr<i>x</i>,<i>y</i>,<i>w</i>,<i>h</i>,<i>z</i>]</td>
	    <td rowspan="2">Color rectangle</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[cr<i>x</i>,<i>y</i>,<i>w</i>,<i>h</i>,<i>r</i>,<i>g</i>,<i>b</i>]</td>
	</tr>
	<tr>
	    <td>[f<i>x</i>,<i>y</i>]</td>
	    <td>Field data</td>
	    <td>No</td>
	</tr>
	<tr>
	    <td>[flt<i>x</i>o<i>y</i>]</td>
	    <td rowspan="2">Flashing text</td>
	    <td rowspan="2">No</td>
	</tr>
	<tr>
	    <td>[flo<i>y</i>t<i>x</i>]</td>
	</tr>
	<tr>
	    <td>[fo<i>x</i>]</td>
	    <td rowspan="2">Change font</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[fo<i>x</i>,<i>cccc</i>]</td>
	</tr>
	<tr>
	    <td>[g<i>n</i>]</td>
	    <td rowspan="3">Place graphic</td>
	    <td rowspan="3">Yes</td>
	</tr>
	<tr>
	    <td>[g<i>n</i>,<i>x</i>,<i>y</i>]</td>
	</tr>
	<tr>
	    <td>[g<i>n</i>,<i>x</i>,<i>y</i>,<i>cccc</i>]</td>
	</tr>
	<tr>
	    <td>[hc<i>n</i>]</td>
	    <td>Hexadecimal character</td>
	    <td>No</td>
	</tr>
	<tr>
	    <td>[jl<i>n</i>]</td>
	    <td>Line justification</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[jp<i>n</i>]</td>
	    <td>Page justification</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[ms<i>x</i>,<i>y</i>]</td>
	    <td>Manufacturer specific</td>
	    <td>No</td>
	</tr>
	<tr>
	    <td>[mv<i>…</i>]</td>
	    <td>Moving text</td>
	    <td>No</td>
	</tr>
	<tr>
	    <td>[nl]</td>
	    <td rowspan="2">New line</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[nl<i>s</i>]</td>
	</tr>
	<tr>
	    <td>[np]</td>
	    <td>New page</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[pt<i>n</i>]</td>
	    <td rowspan="2">Page time</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[pt<i>n</i>o<i>f</i>]</td>
	</tr>
	<tr>
	    <td>[sc<i>x</i>]</td>
	    <td>Character spacing</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[tr<i>x</i>,<i>y</i>,<i>w</i>,<i>h</i>]</td>
	    <td>Text rectangle</td>
	    <td>Yes</td>
	</tr>
</table>
<br/>

<h4 id="quick_msg">Quick Messages</h4>
<p>
	A quick message is a fully composed DMS message which can be associated
	with a sign group.
	When a DMS is selected, a drop-down list is populated with quick
	messages from sign groups of which that DMS is a member.
	Quick messages are also be used for <a href="#dms_actions">DMS
	actions</a> as part of an <a href="#action_plans">action plan</a>.
	For these messages, it is best to leave the sign group blank.
</p>

<h3 id="cameras">Cameras</h3>
<aside>
	Select <span class="menu">View ➔ Video ➔ Cameras</span> menu item
</aside>
<p>
	Closed-circuit television cameras are commonly used to monitor traffic
	conditions.
	These cameras can transmit video to a traffic management center using
	either an analog signal (with dedicated cabling) or a digital stream
	(using an IP network).
	There are advantages to both approaches.
	Analog video has high picture quality and very low latency, while
	digital video is much cheaper and easier to route around.
</p>
<p>
	To display camera video in IRIS, it must be digitally encoded.
</p>
<h4 id="camera_setup">Camera Setup</h4>
<p>
	The camera <b>Setup</b> tab contains attributes to configure the
	encoded stream.
</p>
<dl>
    <dt>encoder_type</dt>
    <dd>The type of encoder for the video stream: GENERIC, AXIS or INFINOVA</dd>
    <dt>encoder</dt>
    <dd>The encoder stream URI.
        Usually, only the host name (or ip address) is needed here.
        For GENERIC encoder types, the path is also required.
        The default URI scheme is determined by the stream type, but can be
        overridden here (for example "mms://" or "axrtsp://").
    </dd>
    <dt>enc_mcast</dt>
    <dd>Multicast stream URI.</dd>
    <dt>encoder_channel</dt>
    <dd>For encoders with more than 1 channel.</dd>
    <dt>stream_type</dt>
    <dd>The video stream type: UNKNOWN, MJPEG, MPEG4, H264, H265</dd>
    <dt>publish</dt>
    <dd>Flag to allow stream to be published.</dd>
</dl>
<h4 id="ptz">Pan / Tilt / Zoom</h4>
<p>
	Some cameras have a built-in pan/tilt/zoom (PTZ) functionality.
	IRIS can perform the following PTZ operations:
</p>
<ul>
	<li>Panning / tilting the camera</li>
	<li>Recall preset positions</li>
	<li>Store preset positions</li>
	<li>Zooming in or out</li>
	<li>Manual focus: near / far</li>
	<li>Manual iris: open / close</li>
	<li>Wiper control</li>
</ul>
<p>
	For PTZ control to function, the camera must be associated with a
	<a href="#controllers">controller</a> on a PTZ protocol
	<a href="#comm_links">comm link</a>.
</p>
<h4 id="video">Video Switching</h4>
<p>
	IRIS can also be configured to send commands to a video switcher
	system.
	This allows camera video (or streams) to be routed to a number of video
	monitors.
	Each monitor can be assigned to display the video from any specific
	camera.
	IRIS allows an operator to select one video monitor to be linked with
	their camera selection on the user interface.
	This way, every time the user selects a camera, it's video is
	immediately displayed on the associated monitor.
</p>
<h5 id="cam_tool">Camera Selector Tool</h5>
<p>
	There is a simple camera selector tool on the toolbar just below the
	map.
	It has a text entry field with an icon and label.
	This tool allows quick switching of the selected camera.
</p>
<h5 id="numpad">Numpad Hotkeys</h5>
<p>
	The keyboard "numpad" can be used from anywhere within IRIS to control
	the camera selector tool.
	When the <b>Num Lock</b> key is off, all numpad keystrokes are directed
	to the tool.
	Pressing the <code>*</code> key (on the numpad) changes to video monitor
	selection &mdash; the icon will change to indicate this change.
	The <code>+</code> and <code>-</code> keys can select the next and
	previous cameras, respectively.
</p>

<h3 id="vds">Vehicle Detection Systems</h3>
<p>
	There are several types of <b>vehicle detection systems</b> (VDS)
	&mdash; also called <b>traffic sensing systems</b>.
	The oldest of these is the inductive loop detector, which is a
	wire placed under the surface of the road.
	It is able to magnetically detect the metal in vehicles as they pass
	over.
	Another type of sensor uses radar mounted on the side of the road.
	This type is <b>non-intrusive</b>, since the road surface does not need
	to be cut to install the detector.
	A third type &ndash; also non-intrusive &ndash; is video detection.
	These systems use video cameras and computer vision software to
	detect vehicles.
</p>
<h4>VDS Configuration</h4>
<p>
	To create a detector, first select the <a href="#r_node">r_node</a>
	at the location of the detector.
	Then, select the <b>Detectors</b> tab for the r_node.
	Type the detector name in the text entry widget just above the
	<b>Create</b> button, and press that button.
	After selecting the new detector in the r_node detector table,
	its properties, such as <b>lane type</b> and <b>lane #</b> can be
	changed.
	In IRIS, lanes are numbered from right-to-left, starting with the
	right lane as 1.
</p>
<p>
	When a detector fails, <b>fake</b> data may be used for flow, speed
	and density.
	In the simplest case, one or more detectors can be used to calculate
	the fake data.
	To do this, put the detector ID(s) in the <b>fake</b> field (separated
	by spaces).
</p>

<h4>VDS Protocols</h4>
<p>
	IRIS supports several different protocols for communicating with
	vehicle detection systems.
	For most VDS protocols, traffic data is binned at a fixed time interval.
	Some protocols allow the binning interval to be adjusted.
	IRIS collects traffic data including <b>volume</b> (traffic counts),
	<b>occupancy</b>, <b>speed</b>, and <b>vehicle classification</b>.
	Some protocols do not use binning at all &mdash; instead they record
	timestamps and headway for each vehicle passing by the sensor.
	The following table summarizes features of each protocol.
</p>
<table>
	<tr>
	    <th>Protocol</th>
	    <th>Addressing</th>
	    <th>Binning</th>
	    <th>Speed</th>
	</tr>
	<tr>
	    <th>MnDOT 170 4</th>
	    <td>4-bit (1-15)</td>
	    <td>30 seconds (+5 minute)</td>
	    <td>No</td>
	</tr>
	<tr>
	    <th>MnDOT 170 5</th>
	    <td>5-bit (1-31)</td>
	    <td>30 seconds (+5 minute)</td>
	    <td>No</td>
	</tr>
	<tr>
	    <th>Canoga</th>
	    <td>8-bit (1-255)</td>
	    <td>No (vehicle logging)</td>
	    <td>Double loops only</td>
	</tr>
	<tr>
	    <th>SS105</th>
	    <td>4-digit (0001-9999)</td>
	    <td>5 seconds to 1 month</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <th>SS125</th>
	    <td>32-bit (0-65535)</td>
	    <td>???</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <th>RTMS G4</th>
	    <td>32-bit (0-65535)</td>
	    <td>10 seconds to 1 hour</td>
	    <td>Yes</td>
	</tr>
</table>
<br/>
<h4 id="vds_archiving">VDS Data Archiving</h4>
<p>
	Every 30 seconds, an XML file is generated containing the most recent
	sample data from all defined detectors.
	The file is called det_sample.xml.gz, and it is written to the
	<a href="#xml_output">XML output directory</a>
</p>
<p>
	Sample data is archived only if the <code>sample_archive_enable</code>
	<a href="#system_attributes">system attribute</a> is set to
	<code>true</code>.
	Sample archive files are stored in <code>/var/lib/iris/traffic</code>,
	in a directory with the district ID name.
</p>

<h3 id="lcs">Lane-use Control Signs (LCS)</h3>
<aside>
	Select <span class="menu">View ➔ Lane Use ➔ LCS</span> menu item
</aside>
<p>
	A lane-use control sign (LCS) is a sign which is mounted over a single
	lane of traffic (typically one for each lane).
	It can display a set of indications which either permit or restrict
	use of that lane.
</p>

<h4 id="ilcs">"Intelligent" Lane-use Control Signs (ILCS)</h4>
<p>
	An "intelligent" LCS is a full-matrix color <a href="#dms">DMS</a> which
	is mounted directly over a lane of traffic.
	In addition to being used as an LCS, it can display
	<a href="#vsa">variable speed advisories</a>, or any operator-defined
	message as a regular DMS.
</p>

<h4 id="dlcs">"Dumb" Lane-use Control Signs (DLCS)</h4>
<p>
	A "dumb" LCS device is much simpler than an ILCS.
	It can display one of a fixed set of indications &mdash; typically a
	<i>green arrow</i> <span class="green">&nbsp;↓&nbsp;</span>, a
	<i>yellow arrow</i> <span class="yellow">&nbsp;↓&nbsp;</span> or a
	<i>red X</i> <span class="red">&nbsp;X&nbsp;</span>).
	Each indication must be assigned to a separate
	<a href="#io_pins">I/O pin</a> on a
	<a href="#controllers">controller</a>, as well as the DMS which
	represents the LCS.
</p>

<h3 id="ramp_meters">Ramp Meters</h3>
<aside>
	Select <span class="menu">View ➔ Ramp Meters</span> menu item
</aside>
<p>
	A ramp meter is a traffic signal at an on-ramp which controls the rate
	of vehicles entering a freeway.
	Typically, one vehicle is permitted to enter for each green indication
	displayed on the signal.
</p>
<p>
	The following operations can be performed on a ramp meter:
</p>
<ul>
	<li>Activating and deactivating meter</li>
	<li>Adjusting meter release rate</li>
	<li>Querying meter status</li>
	<li>Querying green counts</li>
	<li>Synchronizing clock</li>
	<li>Configuring time-of-day operation</li>
</ul>

<h3 id="gate_arms">Gate Arms</h3>
<aside>
	Select <span class="menu">View ➔ Gate Arm Arrays</span> menu item
</aside>
<p>
	Gate arms are traffic control devices which restrict access to a
	section of roadway.
	They can be used, for example, for reversible lanes which can be changed
	by time of day.
</p>
<p>
	Gate arms are controlled as arrays of 1-8 gate arms.
	Opening or closing an array will control all gate arms in the array.
</p>
<p>
	Up to two <a href="#cameras">cameras</a> can be associated with a gate
	arm array.
	This allows operators to verify the status and check traffic conditions
	before opening or closing a gate arm array.
</p>
<p>
	A <a href="#dms">DMS</a> can be associated with a gate arm array, to
	inform motirists.
	Two <a href="#quick_msg">quick messages</a>, for <em>open</em> and
	<em>closed</em> will be automatically sent to the DMS.
</p>
<h4 id="interlocks">Interlocks</h4>
<p>
	Great care must be taken to prevent traffic conflicts when using gate
	arms.
	Two types of <em>interlock</em> are available for this purpose.
	An <em>open interlock</em> is a constraint which prevents the gate arm
	from being opened within IRIS.
	Similarly, a <em>close interlock</em> prevents the gate arm from being
	closed.
</p>
<p>
	When a gate arm is open, all other gate arms on the same roadway, but in
	any other direction will have an <em>open interlock</em>.
</p>
</p>
	Each gate arm can be assigned a <em>prerequisite</em> gate arm (on the
	same roadway and direction).
	This configuration prevents the gate arm from opening until the
	prerequisite has been opened, using an <em>open interlock</em>.
	Once a gate arm and its prerequisite are both open, the prerequisite
	gate arm will have a <em>close interlock</em> until the other gate arm
	is closed.
</p>
<p>
	If communication is lost to a gate arm, the state will be unknown by
	IRIS.
	After 90 seconds, it will be treated as <em>possibly open</em>, causing
	interlocks to be checked.
	Also, an email will be sent to the address in the
	<code>email_recipient_gate_arm</code>
	<a href="#system_attributes">system attribute</a>.
</p>
<h4 id="gate_conflict">Conflicts</h4>
<p>
	If a <em>conflict</em> is detected, an <em>alert</em> email will be sent
	to the address in the <code>email_recipient_gate_arm</code>
	<a href="#system_attributes">system attribute</a>.
	An <em>open conflict</em> exists when an <em>open interlock</em>
	constraint is broken.
	Similarly, a <em>close conflict</em> exists for <em>close interlock</em>
	constraints.
	IRIS will not automatically try to resolve conflicts.
</p>
<h4 id="gate_security">Gate Arm Security</h4>
<p>
	There are a couple of extra security features to restrict access to
	gate arm control.
	There is a whitelist of IP addresses from which IRIS clients are allowed
	to control gate arms.
	It is specified as a property in the
	<code>/etc/iris/iris-server.properties</code> configuration file.
	The property is <code>gate.arm.whitelist</code>, and it contains a list
	of addresses in CIDR notation (exact IP, or ranges specified as
	192.168.1.0/24).
</p>
<p>
	Another gate arm security feature causes the entire "gate arm system"
	to be disabled whenever any configuration change is made to a gate arm.
	This includes any changes to a gate arm array, controller or associated
	comm link.
	IRIS will not send any command to open or close any gate arm in this
	state.
	The only way to re-enable gate arm control is to create a file at
	<code>/var/lib/iris/gate_arm_enable</code> (using touch).
</p>

<h3 id="tag_readers">Tag Readers</h3>
<aside>
	Select <span class="menu">View ➔ Lane Use ➔ Tag Readers</span> menu item
</aside>
<p>
	A tag reader is a sensor for in-vehicle transponders (tags).
	When a tag is read, an event is logged in the database.
	The event includes the date and time, tag ID, toll zone and tollway.
	This information can be used for <a href="#tolling">tolling</a>
	operation.
</p>

<h3 id="beacons">Beacons</h3>
<aside>
	Select <span class="menu">View ➔ Message Signs ➔ Beacons</span> menu
	item
</aside>
<p>
	A beacon is a light or set of lights that flashes toward oncoming
	traffic.
	Its purpose is to draw attention to a <a href="#dms">DMS</a> or static
	sign.
	Sometimes, they are called <b>flashers</b> or <b>wig-wags</b>.
	Internal and external beacons are supported. Internal beacons are
	controlled through the DMS controller, are activated through the
	NTCIP DMS protocol and are considered part of the DMS. External
	beacons use dedicated controllers and protocols (e.g. MNDOT 170 4,
	MNDOT 170 5).
</p>

<h3 id="alarms">Alarms</h3>
<aside>
	Select <span class="menu">View ➔ Maintenance ➔ Alarms</span> menu item
</aside>
<p>
	An alarm is a simple device triggered by an event.
	The event might be an equipment failure, high temperature, or low
	voltage in a field controller.
	Alarms can be monitored to help maintain field devices.
	Device drivers trigger alarms based on field controller states,
	information read from controllers (e.g. voltages), etc.
	Users can view the status of alarms on the Alarm Form. The Status
	Column indicates the state of each alarm, which can be Clear or
	Triggered.
	Alarms are created using the Alarm Form and can only be created for
	controllers using a protocol driver that generate alarms.
	For example, the MnDOT ramp meter drivers.
</p>

<h3 id="rwis">Road Weather Information Systems</h3>
<aside>
	Select <span class="menu">View ➔ Weather Sensors</span> menu item
</aside>
<p>
	Road Weather Information Systems (RWIS) can sense data such as
	precipitation rate, road surface temperature, wind speed, etc.
</p>

<h3 id="lane_marking">Lane Marking</h3>
<aside>
	Select <span class="menu">View ➔ Lane Use ➔ Lane Markings</span> menu
	item
</aside>
<p>
	A lane marking device is also called <b>in-road lighting</b>.  It allows
	the lane striping to be changed dynamically, by turning on and off
	lights embedded in the road.
</p>

<h2 id="features">Features</h2>

<h3 id="traffic_layer">Traffic Map Layer</h3>
<p>
	The IRIS client user interface includes a traffic map layer which is
	created automatically from the <a href="#road_topology">road
	topology</a>.
	By default, this "segment" layer uses traffic <b>density</b> to
	determine the color of each segment in the layer.
	Other themes are available for <b>speed</b> and <b>flow</b>.
	The <b>Legend</b> menu at the top of the map can be used to view
	the thresholds used for each color in a theme.
</p>
<p>
	Every 30 seconds, the client will make an HTTP request for the current
	traffic sample data XML file.
	The URL to locate that file is declared as a property in the
	/etc/iris/iris-client.properties file (on the IRIS server).
	The property is tdxml.detector.url, and it should point to the location
	of <a href="#vds_archiving">det_sample.xml.gz</a>, as made
	available by apache on the IRIS server.
</p>
<p>
	The appearance of the traffic map layer changes depending on the current
	map zoom level.
	If the zoom level is below 10, the layer will not be visible.
	At zoom levels 10 through 13, the layer will display segments as
	aggregate of all detectors in each mainline station.
	At zoom level 14 or above, each mainline detector will be displayed
	as a separate segment.
</p>

<h3 id="incident_management">Incident Management</h3>
<p>
	The <b>Incident</b> tab on the client interface is used to manage
	incidents within IRIS.
	Traffic incidents have several attributes, including location, type,
	detail, camera and lane impact.
	Active incidents are written to an <a href="#xml_output">XML file</a>,
	which can be processed by external systems.
</p>
<h4>Creating an Incident</h4>
<p>
	The user interface for creating incidents is streamlined to allow
	operators to process them quickly.
	First, click one of the incident type buttons: <b>Crash</b>,
	<b>Stall</b>, <b>Road Work</b> or <b>Hazard</b>.
	Then, the lane type can be selected &mdash; <i>Mainline</i> is the
	default, but <i>Exit</i>, <i>Entrance</i> and <i>CD Road</i> are
	available.
	Now, the incident location must be selected on the map (the mouse cursor
	will change to a crosshair).
	After that the incident detail, verification camera and lane impact
	can be selected (if required).
	The camera list will be populated with a few cameras near the location
	selected.
	The lane impact is represented by boxes for each lane at the incident
	location, including both shoulders.
	Each lane can be marked clear (default), blocked (red) or partially
	blocked (yellow) by clicking on the box.
	Once the attributes have been set, press the <b>Log</b> button to create
	the incident.
	A triangular icon will appear on the map pointing in the direction of
	travel, color-coded with the incident type.
</p>
<h4>Editing an Incident</h4>
<p>
	To change the location or verification camera, the <b>Edit</b> button
	must be pressed first.
	To change the lane impact or to clear the incident, the <b>Edit</b>
	button is not required.
	After making changes, be sure to press the <b>Log</b> button again.
	Once an incident has been cleared, it will be removed from the list
	after 5 minutes.
	This allows a cleared incident to be reactivated if necessary.
</p>
<h4>Deploying Devices</h4>
<p>
	Devices can be deployed based on the incident impact by pressing the
	<b>Deploy</b> button.
	This will bring up a form with a list of suggested devices to deploy for
	the incident.
	The list may include <a href="#lcs">Lane-use control signals</a> or
	<a href="#dms">Dynamic Message Signs</a>.
	All DMS within the range of the incident are checked.
	Each of these DMS will be deployed if matching
	<a href="#inc_descriptor">descriptor</a>, <a href="#inc_locator">locator
	</a> and <a href="#inc_advice">advice</a> are found.
</p>
<h5 id="inc_descriptor">Incident Descriptor</h5>
<aside>
	Select <span class="menu">View ➔ Incident ➔ Incident Descriptor</span>
	menu item
</aside>
<p>
	An incident matches a descriptor only if all the attributes match.
	Each matching descriptor will be checked to see if the
	<a href="#multi">MULTI</a> string can be rendered on the DMS.
</p>
<dl>
	<dt>Sign group<dt>
	<dd>A group of signs with similar dimensions</dd>
	<dt>Event Type</dt>
	<dd>CRASH, STALL, ROAD WORD, HAZARD</dd>
	<dt>Lane Type</dt>
	<dd>mainline, exit, merge, CD lane</dd>
	<dt>Detail</dt>
	<dd>animal, debris, ice, etc.</dd>
	<dt>Cleared Flag</dt>
	<dd>yes / no</dd>
</dl>
<h5 id="inc_locator">Incident Locator</h5>
<aside>
	Select <span class="menu">View ➔ Incident ➔ Incident Locator</span> menu
	item
</aside>
<p>
	The incident is associated with the nearest <em>pickable</em>
	<a href="#r_node">r_node</a>.
	If the distance to that node is less than 1 mile, it can be used as a
	<em>locator</em>.
	If not, the nearest <em>non-pickable</em> r_node is found.
	It can be used if distance is less than 1 mile.
</p>
<p>
	An incident matches a locator only if all the attributes match.
	Each matching locator will be checked to see if the
	<a href="#multi">MULTI</a> string can be rendered on the DMS.
</p>
<dl>
	<dt>Sign group<dt>
	<dd>A group of signs with similar dimensions</dd>
	<dt>Range</dt>
	<dd>near, middle, far</dd>
	<dt>Branched</dt>
	<dd>no / yes</dd>
	<dt>Pickable</dt>
	<dd>no / yes</dd>
</dl>
<p>
	One "<a href="#multi">MULTI</a>-like" tag is defined for incident
	locators.
</p>
<table>
	<tr>
		<th>Tag Value</th>
		<th>Description</th>
	</tr>
	<tr>
		<td>[locrn]</td>
		<td>Road name</td>
	</tr>
	<tr>
		<td>[locrd]</td>
		<td>Road direction</td>
	</tr>
	<tr>
		<td>[locmd]</td>
		<td>Location modifier (AT, N OF, S OF, etc.)</td>
	</tr>
	<tr>
		<td>[locxn]</td>
		<td>Cross-street name</td>
	</tr>
	<tr>
		<td>[locxa]</td>
		<td>Cross-street abbreviation</td>
	</tr>
	<tr>
		<td>[locmi]</td>
		<td>Miles from DMS to node</td>
	</tr>
</table>
<p>
	Road names are converted to all capital letters.
	For the `[locrn]` and `[locxn]` tags, certain prefixes and suffixes are
	replaced with other values.
	For the `[locxa]` tag, all matching prefixes and suffixes are stripped.
</p>
<h5 id="inc_advice">Incident Advice</h5>
<aside>
	Select <span class="menu">View ➔ Incident ➔ Incident Advice</span> menu
	item
</aside>
<p>
	An incident matches an advice record only if all attributes match.
</p>
<dl>
	<dt>Sign group<dt>
	<dd>A group of signs with similar dimensions</dd>
	<dt>Range</dt>
	<dd>near, middle, far</dd>
	<dt>Lane Type</dt>
	<dd>mainline, exit, merge, CD lane</dd>
	<dt>Impact</dt>
	<dd>Lane impact code</dd>
	<dt>Cleared Flag</dt>
	<dd>yes / no</dd>
</dl>
<p>
	A lane impact code is defined for all lanes plus both shoulders.
	So, for a two-lane r_node, the impact code would be 4 characters.
</p>
<table>
	<tr>
		<th>Code</th>
		<th>Description</th>
	</tr>
	<tr>
		<td>.</td>
		<td>Not blocked</td>
	</tr>
	<tr>
		<td>?</td>
		<td>Partially blocked</td>
	</tr>
	<tr>
		<td>!</td>
		<td>Fully blocked</td>
	</tr>
	<tr>
		<td>:</td>
		<td>Partially of fully blocked (? or !)</td>
	</tr>
	<tr>
		<td>;</td>
		<td>Not fully blocked (. or ?)</td>
	</tr>
	<tr>
		<td>,</td>
		<td>Any (. ? or !)</td>
	</tr>
</table>
<br/>
<h3 id="action_plans">Action Plans</h3>
<aside>
	Select <span class="menu">View ➔ Plans and Schedules</span> menu item
</aside>
<p>
	Action plans provide a way to coördinate multiple related actions
	at the same time.
	Possible actions include displaying <a href="#dms">DMS</a> messages,
	activating <a href="#beacons">beacons</a> and operating
	<a href="#ramp_meters">ramp meters</a>.
	Simple action plans can have just two phases: deployed or undeployed.
	More advanced plans can have many phases, each with separate actions.
	If the <b>Sync Actions</b> box is checked, the phase can only be changed
	if all associated devices are online.
	If the <b>Sticky</b> box is checked, DMS messages will be configured to
	remain even if communication or power is lost.
</p>
<h4 id="dms_actions">DMS Actions</h4>
<p>
	DMS actions have an associated sign group to determine which signs are
	affected by the action.
	The action happens when the action plan phase matches the <b>phase</b>
	of the DMS action.
	The <a href="#quick_msg">quick message</a> indicates which message is
	activated by the plan.
	<b>Activation</b> and <b>run-time priorities</b> determine which of
	multiple actions will take precedence.
</p>
<h4 id="action_tag">DMS Action Tags</h4>
<p>
	Some "<a href="#multi">MULTI</a>-like" tags are supported in
	<a href="#quick_msg">quick messages</a> used by DMS actions.
	These tags are interpreted by IRIS before sending the message to the
	DMS.
</p>
<table>
	<tr>
	    <th>Tag</th>
	    <th>Description</th>
	</tr>
	<tr>
	    <td>[feed<i>n</i>]</td>
	    <td><a href="#msg_feed">Message feed</a></td>
	</tr>
	<tr>
	    <td>[tt<i>n</i>]</td>
	    <td><a href="#travel_time">Travel time</a></td>
	</tr>
	<tr>
	    <td>[vsa]</td>
	    <td><a href="#vsa">Speed advisory</a></td>
	</tr>
	<tr>
	    <td>[slow<i>s</i>,<i>b</i>,<i>u</i>,<i>dist</i>]</td>
	    <td><a href="#slow">Slow traffic warning</a></td>
	</tr>
	<tr>
	    <td>[tz<i>{p,o,c}</i>,<i>{tz0},</i>…<i>{tzn}</i>]</td>
	    <td><a href="#tolling">Toll Zone</a></td>
	</tr>
</table>
<br/>

<h3 id="schedules">Date/Time Schedules</h3>
FIXME

<h3 id="travel_time">Travel Time Estimation</h3>
FIXME

<h3 id="vsa">Variable Speed Advisory</h3>
FIXME

<h3 id="slow">Slow Traffic Warning</h3>
<p>
	A <b>slow</b> <a href="#action_tag">action tag</a> allows warnings to be
	displayed on DMS when traffic is slow.
	The tag has three parameters, separated by commas.
</p>
<ol>
	<li>Highest speed to activate the warning, in mph.</li>
	<li>Distance (tenths of mile) to search for slow traffic, relative to
	    the DMS location.</li>
	<li>Tag replacement mode (<b>none</b> if omitted)
	    <ul>
	        <li><b>none</b>: a blank string</li>
	        <li><b>dist</b>: distance rounded to nearest mile</li>
	        <li><b>speed</b>: speed rounded to nearest 5 mph</li>
	    </ul>
	</li>
</ol>
<dl>
	<dt>[slow35, 10]SLOW[nl]TRAFFIC[nl]AHEAD</dt>
	<dd>Displays if traffic slower than 35 mph within 1 mile</dd>
	<dt>SLOW TRAFFIC[nl][slow40,60,dist] MILES[nl]USE CAUTION</dt>
	<dd>Displays if traffic slower than 40 mph within 6 miles</dd>
	<dt>[slow45,5,speed] MPH[nl]1/2 MILE[nl]AHEAD</dt>
	<dd>Displays if traffic slower than 45 mph within 0.5 miles</dd>
</dl>
<p>
</p>

<h3 id="tolling">Tolling</h3>
<p>
	High-occupancy / toll (HOT) lanes can be operated through IRIS.
	Functions include calculating tolls in real time based on density,
	displaying prices on DMS, and logging vehicle <a href="#tag_readers">
	transponder (tag)</a> information.
	Customer accounts and billing are not supported; those features must
	be provided by an external system.
</p>
<h4>Toll Zones</h4>
<aside>
	Select <span class="menu">View ➔ Lane Use ➔ Toll Zones</span> menu item
</aside>
<p>
	A toll zone is a segment of roadway between two stations.
	All HOT lane detectors between the starting station and ending station
	can be used to calculate the toll.
	Every 3 minutes, tolls are calculated using data from the most recent 6
	minutes.
	Within a zone, each station has an associated toll, based on the highest
	density recorded among HOT lane detectors downstream of that station.
</p>
<div class="label">p = α ⋅ k <sup>β</sup>, where α = 0.045 and β = 1.10</div>
<p>
	The toll price is then rounded to the nearest $0.25.
</p>
<h4>Pricing on DMS</h4>
<p>
	A DMS can display pricing information for toll zones.
	This is accomplished using a <b>tz</b> <a href="#action_tag">action
	tag</a>.
	The tag has two or more parameters, separated by commas.
	The first parameter is the tolling mode, and must be "<i>p</i>",
	"<i>o</i>" or "<i>c</i>".
	These indicate <i>priced</i>, <i>open</i> or <i>closed</i>,
	respectively.
	The second parameter is the (first) toll zone ID.
	If the toll route spans multiple toll zones, additional zone IDs may be
	provided after the first.
</p>
<p>
	If the tolling mode is <i>priced</i>, the tag will be replaced with the
	calculated price, for example "2.75".
	It will be the sum of prices for all specified toll zones.
	Two <a href="#system_attributes">system attributes</a>,
	<code>toll_min_price</code> and <code>toll_max_price</code>, limit the
	calculated price.
</p>
<p>
	For <i>open</i> and <i>closed</i> modes, the tag will be replaced with
	an empty string.
	If required, a message such as "OPEN" or "CLOSED" may be appended after
	the tag.
</p>
<p>
	Price events are logged when a message is sent to a DMS, and again when
	the message is verified.
	The price event includes the date and time, toll zone, tolling mode
	(<i>priced</i>, <i>open</i>, <i>closed</i>), price, sent / verified
	status and next downstream tag reader.
	The logged toll zone is the last zone specified in the tag.
	In <i>priced</i> mode, the displayed price is logged.
	For <i>open</i> or <i>closed</i>, a price of 0 is logged.
</p>
<h4>Tag Readers</h4>
<p>
	<a href="#tag_readers">Tag readers</a> can be mounted over a tolled lane
	to record customer trips.
	These are typically located just downstream of a pricing DMS.
	The tag read events can be combined with the logged pricing information
	to build a list of trips for each tag ID.
	This information can be used to bill customers.
</p>
<h3 id="metering_strategies">Ramp Metering Strategies</h3>
FIXME

<h3 id="spellchecker">Spell Checker</h3>
<p>
	The system attributes <i>dict_allowed_scheme</i> and
	<i>dict_banned_scheme</i> enable <a href="#dms">DMS</a>	spell checker
	functionality.
	The <i>dict_allowed_scheme</i> system attribute corresponds to the
	Allowed Word List (white-list) defined on the Dictionary Form.
	The <i>dict_banned_scheme</i> system attribute provides similar
	functionality but for the Banned Word List on the Dictionary Form.
</p>
<p>
	When an operator presses the DMS Send Button, each word in the DMS
	message is compared against words defined in the dictionary.
	A form appears if the DMS message contains words that don't appear on
	the Allowed List or do appear on the Banned List.
	The system attributes control if these rules are enforced or if IRIS
	merely provides a recommendation to not use the word.
</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="error_logs">Error Logs</h3>
FIXME

<h3 id="xml_output">XML Output</h3>
<p>
	There are a number of XML files which are written by the IRIS server
	periodically.
	These files contain configuration information about the system as
	well as realtime data concerning the current state.
	These files are stored in the /var/www/html/iris_xml/ directory.
</p>
<table>
	<tr>
	    <th>Filename</th>
	    <th>Description</th>
	    <th>Period</th>
	</tr>
	<tr>
	    <td>tms_config.xml.gz</td>
	    <td>Configuration data for IRIS system.  If the
		<a href="#district">district</a> server property is changed, the
		filename will be changed to match {district}_config.xml.gz.</td>
	    <td>24 hours</td>
	</tr>
	<tr>
	    <td>det_sample.xml.gz</td>
	    <td>Sample data from <a href="#vds">vehicle detection systems</a>
	    </td>
	    <td>30&nbsp;seconds</td>
	</tr>
	<tr>
	    <td>stat_sample.xml.gz</td>
	    <td>Mainline station data from <a href="#vds">vehicle detection
	        systems</a>
	    </td>
	    <td>30 seconds</td>
	</tr>
	<tr>
	    <td>incident.xml.gz</td>
	    <td>Current incident information</td>
	    <td>30 seconds</td>
	</tr>
	<tr>
	    <td>sign_message.xml.gz</td>
	    <td>Current DMS sign message information</td>
	    <td>30 seconds</td>
	</tr>
</table>
<p/>

<h3 id="event_tables">Database Event Tables</h3>
FIXME

<h3 id="debug_logs">Debug Trace Logs</h3>
<p>
	There are some debugging logs which can be enabled in the /var/log/iris
	directory.
	To enable a particular log, use the <code>touch</code> command to
	create a file with the proper name.
	Some of these logs can grow very large, so be sure to have enough disk
	space available.
</p>
<table>
	<tr>
	    <th>Filename</th>
	    <th>Description</th>
	</tr>
	<tr>
	    <td>addco</td>
	    <td>Addco DMS protocol</td>
	</tr>
	<tr>
	    <td>bottleneck</td>
	    <td>Bottleneck calculation for VSA algorithm</td>
	</tr>
	<tr>
	    <td>canoga</td>
	    <td>Canoga detector protocol</td>
	</tr>
	<tr>
	    <td>cbw</td>
	    <td>Control By Web protocol</td>
	</tr>
	<tr>
	    <td>comm</td>
	    <td>Communication errors with controllers</td>
	</tr>
	<tr>
	    <td>device</td>
	    <td>Device error log</td>
	</tr>
	<tr>
	    <td>dinrelay</td>
	    <td>Din-relay protocol</td>
	</tr>
	<tr>
	    <td>dmsxml</td>
	    <td>DMS-XML protocol</td>
	</tr>
	<tr>
	    <td>e6</td>
	    <td>E6 tag reader protocol</td>
	</tr>
	<tr>
	    <td>e6_pkt</td>
	    <td>E6 tag reader protocol packets</td>
	</tr>
	<tr>
	    <td>feed</td>
	    <td>Msgfeed protocol</td>
	</tr>
	<tr>
	    <td>g4</td>
	    <td>G4 detector protocol</td>
	</tr>
	<tr>
	    <td>infinova</td>
	    <td>Infinova PTZ protocol</td>
	</tr>
	<tr>
	    <td>kadaptive</td>
	    <td>K Adaptive metering algorithm</td>
	</tr>
	<tr>
	    <td>manchester</td>
	    <td>Manchester PTZ protocol</td>
	</tr>
	<tr>
	    <td>meter</td>
	    <td>Ramp meter configuration errors</td>
	</tr>
	<tr>
	    <td>mndot170</td>
	    <td>MnDOT protocol</td>
	</tr>
	<tr>
	    <td>modem</td>
	    <td>Modem error log</td>
	</tr>
	<tr>
	    <td>ntcip</td>
	    <td>NTCIP protocols</td>
	</tr>
	<tr>
	    <td>org815</td>
	    <td>ORG-815 rain guage protocol</td>
	</tr>
	<tr>
	    <td>pelco</td>
	    <td>Pelco switcher protocol</td>
	</tr>
	<tr>
	    <td>pelcod</td>
	    <td>Pelco-D PTZ protocol</td>
	</tr>
	<tr>
	    <td>polling</td>
	    <td>Generic operaton polling log</td>
	</tr>
	<tr>
	    <td>prio</td>
	    <td>Operation priority log</td>
	</tr>
	<tr>
	    <td>profile</td>
	    <td>System profiling log</td>
	</tr>
	<tr>
	    <td>sched</td>
	    <td>DMS scheduled message log</td>
	</tr>
	<tr>
	    <td>slow</td>
	    <td>DMS <a href="#slow">slow warning</a> system log</td>
	</tr>
	<tr>
	    <td>snmp</td>
	    <td>SNMP error log</td>
	</tr>
	<tr>
	    <td>sonar</td>
	    <td>SONAR connection log</td>
	</tr>
	<tr>
	    <td>sql</td>
	    <td>SQL database error log</td>
	</tr>
	<tr>
	    <td>ss105</td>
	    <td>Wavetronix SS-105 protocol</td>
	</tr>
	<tr>
	    <td>ss125</td>
	    <td>Wavetronix SS-125 protocol</td>
	</tr>
	<tr>
	    <td>ssi</td>
	    <td>SSI weather protocol</td>
	</tr>
	<tr>
	    <td>stc</td>
	    <td>SmartTouch Controller gate arm protocol</td>
	</tr>
	<tr>
	    <td>sys_attr</td>
	    <td>System attribute change log</td>
	</tr>
	<tr>
	    <td>szm</td>
	    <td>Stratified zone metering log</td>
	</tr>
	<tr>
	    <td>toll</td>
	    <td>Tolling info log</td>
	</tr>
	<tr>
	    <td>travel</td>
	    <td>Travel time info log</td>
	</tr>
	<tr>
	    <td>viconptz</td>
	    <td>Vicon PTZ protocol</td>
	</tr>
	<tr>
	    <td>vsa</td>
	    <td>Variable speed advisory info log</td>
	</tr>
</table>

<h2 id="maintenance">Maintenance</h2>
<p>
	Once an IRIS system is set up, there are a few maintenance tasks which
	need to be done to ensure reliable operation.
</p>
<h3 id="database_backups">Database Backup &amp; Restore</h3>
<p>
	It is a good idea to backup the IRIS database on a regular basis.
	This can be done simply with a command such as the following:
</p>
<pre class="code">pg_dump tms | gzip &gt; tms-20120523.sql.gz</pre>
<p>
	This command can be placed in a simple python or bash script which is
	run by cron once per day.
	For off-site backups, the file could be copied to another host, using
	scp or a similar utility.
</p>
<p>
	To restore the tms database from one of these backup files, you will
	first need to shut down the IRIS server (and anything else connected
	to the tms database).
	Then, run the following commands (as tms user):
</p>
<pre class="code">dropdb tms
createdb tms
zcat tms-20120523.sql.gz | pgsql tms</pre>

<h3 id="iris_upgrades">IRIS Upgrades</h3>
<p>
	Upgrading an IRIS system to a new version is a simple process.
	There are two different scenarios to deal with when upgrading:
	<b>stable</b> versus <b>unstable</b>.
	Either way, it's advisable to <a href="#database_backups">backup the
	database</a> before attempting an upgrade.
</p>
<p>
	A stable upgrade is when the major and minor IRIS version numbers do not
	change &mdash; just the <b>micro</b> version.
	So, upgrading from 3.145.0 to 3.145.1 would be a stable updgrade.
	This type of upgrade never involves a database schema change.
	With the new rpm file available, a stable upgrade can be accomplished
	with the following commands (as root):
</p>
<pre class="code">dnf update iris-<i>{major}</i>.<i>{minor}</i>.<i>{micro}</i>-<i>{build}</i>.noarch.rpm
iris_ctl update
systemctl restart iris</pre>
<p>
	An unstable upgrade is when either the major or minor IRIS version
	numbers change.
	Upgrading from 3.144.0 to 3.145.0 would be an unstable upgrade.
	This type of upgrade always involves a database schema change.
	To upgrade the database schema, an SQL migrate script must be run for
	each intervening version.
	The following commands can be used to perform an unstable upgrade
	(as root):
</p>
<pre class="code">dnf update iris-<i>{major}</i>.<i>{minor}</i>.<i>{micro}</i>-<i>{build}</i>.noarch.rpm
psql tms -f /var/lib/iris/sql/migrate-<i>{major}</i>.<i>{minor}</i>.sql
iris_ctl update
systemctl restart iris</pre>
<p>
	Note: when skipping one or more minor versions in an upgrade, <b>all</b>
	migrate scripts must be run.
	So, when upgrading from 3.143.0 to 3.145.0, the database upgrade would
	consist of these commands:
</p>
<pre class="code">psql tms -f /var/lib/iris/sql/migrate-3.144.sql
psql tms -f /var/lib/iris/sql/migrate-3.145.sql</pre>
<p>
	Warning: there is no supported method of <b>downgrading</b> an IRIS
	system.
	If a downgrade is required, the database should be restored from a
	backup and the IRIS rpm should be reinstalled.
</p>

<h3 id="system_updates">System Software Updates</h3>
FIXME

<h3 id="monitoring_logs">Monitoring Logs</h3>
FIXME

<h2 id="development">Development</h2>

<h3 id="building">Building</h3>
<p>
	Install <a href="http://fedoraproject.org">Fedora</a> onto the
	development system.
	Some additional development packages must be installed.
</p>
<pre class="code">dnf install java-devel-openjdk ant-junit mercurial rpm-build gcc</pre>
<p>
	In a suitable development directory, clone the iris mercurial
	repository.
</p>
<pre class="code">hg clone http://iris.dot.state.mn.us/hg/index.cgi/iris</pre>
<p>
	Create lib/ directory in iris development repository.
</p>
<pre class="code">mkdir iris/lib/</pre>
<p>
	Download the <a href="http://www.oracle.com/technetwork/java/index-138643.html">JavaMail API</a> from Oracle.
	Unzip the JavaMail archive and locate the mail.jar file.
	Copy the mail.jar file to the lib/ directory in the iris repository.
</p>
<p>
	Copy <code>iris-build.properties</code> from etc/ to lib/.
	Edit <code>lib/iris-build.properties</code> file as necessary for your
	organization.
</p>
<p>
	Create the key for signing jar packages.
	This is required for Java Web Start, which is used by the IRIS client.
	The key should go into your default keystore (~/.keystore).
</p>
<pre class="code">keytool -genkeypair -alias signing-key</pre>
<p>
	Put the following lines into your ~/.ant.properties file.
</p>
<pre class="code">debug=off
sign.store=${user.home}/.keystore
sign.store.pass=password
sign.alias=signing-key
sign.alias.pass=signing-password
hgbase.url=http://iris.dot.state.mn.us/hg/index.cgi/
</pre>
<p>
	Now, the IRIS rpm file can be built with the following commands.
	(The current directory should be the root of the iris repository.
</p>
<pre class="code">ant rpm</pre>
<p>
	If there are no errors, the new rpm file should be in the
	<code>build/rpm/RPMS/noarch/</code> directory.
</p>

<h3 id="history">History</h3>
<dl>
	<dt>March 1999</dt>
	<dd>Started work on NTCIP DMS control</dd>
	<dt>May 2007</dt>
	<dd>First GPL open source release</dd>
	<dt>May 2008</dt>
	<dd>IRIS live in Caltrans D10</dd>
	<dt>April 2011</dt>
	<dd>Officially adopted by Caltrans</dd>
</dl>

<h3 id="future_plans">Future Plans</h3>
FIXME

<h3 id="contributing">Contributing</h3>
<p>
	FIXME
</p>

<h4 id="contributing">Admin Guide</h4>
<p>
	Please format text so there is a newline after each sentence.
	This makes patches less cluttered.
	Also, line length should be 80 characters or less.
	When patch files are submitted directly, using a .patch file
	extension is preferred.
</p>

<h3 id="coding_style">Coding Style</h3>
<p>
	The coding style for IRIS is focused on making code more readable.
	Readability is the most important factor for software maintenance,
	and it also helps new developers who are unfamiliar with the codebase.
</p>
<p>
	First and foremost, it is recommended that each method fit in one page
	of text (30 lines by 80 columns).
	Whenever possible, longer methods should be decomposed to abide by this
	recommendation.
	This allows a developer to quickly read and understand the method's
	logic.
	It is much easier to spot and correct bugs in shorter methods.
	There should be no blank lines within a method.
</p>
<p>
	With methods longer than one page, it can be beneficial to have a
	single exit point (return).
	But for shorter methods (always the goal), this is not so important,
	and can reduce readability.
	It doesn't make sense to add a local "ret" variable with a single
	return statement at the end when the whole method can be read at a
	glance.
</p>
<p>
	Each block indent should be 8 columns (using tabs instead of spaces).
	This makes the blocks more obvious, and is easier to read than the 4
	spaces commonly used in other Java projects.
	Always use an indented block with if, for, while, etc. statements.
	This makes it much easier to follow the control flow than when it is
	combined onto the same line as the statement.
	Don't put an opening curly brace on a line by itself unless the method
	declaration or loop statement spans multiple lines.
	For single line blocks (if, for, while), do not use curly braces.
</p>
<p>
	Each method should have a javadoc comment describing its purpose.
	All parameters and return values should be documented as well.
	Comments within a method should be used sparingly &mdash; never
	describe what the code is doing, but instead <b>why</b> it was written
	in a certain way.
	Code which is "commented out" should <b>never</b> be committed to a
	repository.
</p>
<p>
	Unary operators, such as ++ -- ! ~ should be adjacent to their operand
	with no space.
	Binary operators, such as + - / * % &amp; | &amp;&amp; || &gt; = &lt;
	&gt;&gt; == != &lt;&lt; &gt;&gt;&gt; &gt;= &lt;= ^ should be separated
	from their operands by a space.
</p>

<h2 id="stepbystep">Step-by-step</h2>
<h3 id="adddms">Create a DMS, Comm Link, and Controller</h3>
<p>
<ol>
<li>Make sure <a href="#edit_mode">edit mode</a> is <b>ON</b>.</li>
<li>Create the new DMS
    <ul>
	<li>Select the <span class="menu">View ➔ Message Signs ➔ DMS
	    </span> menu item to display the DMS form.</li>
	<li>Type the name of the new DMS in the edit field at the bottom
	    of the form and press the Create button.</li>
	<li>Find the new DMS in the data table and select it.</li>
	<li>Click the Properties button and the DMS Properties Form
	    will appear.</li>
	<li>On the Location Tab specify the road and location of the
	    physical DMS.</li>
	<li>On the Messages Tab select the default DMS font.</li>
	<li>Close the DMS Properties form.</li>
    </ul>
</li>
<li>Create a new comm link
    <ul>
	<li>Select the <span class="menu">View ➔ Maintenance ➔ Comm Links
	    </span> menu item to display the Comm Links form.</li>
	<li>Type the name of the new comm link in the edit field in the middle
	    of the form and press the Create button.</li>
	<li>Find the newly created comm link in the data table in the top of the
	    form and select it.</li>
	<li>Enter a more complete description in the Description field as
	    needed.</li>
	<li>Enter the controller URI in the URI column, e.g.
	    "tcp://10.20.30.40:1234" or "udp://10.20.30.40:1234" for signs that
	    use UDP.</li>
	<li>Select the desired protocol.</li>
	<li>Enter the desired polling period and timeout.</li>
	<li>Enable the Comm Link by clicking the Enabled Checkbox.</li>
    </ul>
</li>
<li>Create a new controller associated with the comm link
    <ul>
	<li>In the Comm Link Form with the desired comm link selected, click the
	    Create button on the bottom of the form.</li>
	<li>Select the new controller in the lower data table and click the
	    Properties Button. The Controller Form should appear.</li>
	<li>On the Controller Form Setup Tab, change the condition to active.
	</li>
	<li>On the Cabinet Tab specify the DMS cabinet location and style.</li>
	<li>On the Controller Form IO Tab, for Pin=1, select DMS in the Type
	    column. In the Device column, select the name of the DMS created
	    above.</li>
    </ul>
</li>
<li>View DMS Status
    <ul>
	<li>If the comm link is enabled (per above) and the controller condition
	    is active (per above), the number of successful and failed
	    operations is visible in real-time on the Controller's Status Tab.
	</li>
	<li>View the DMS configuration on the DMS Form Configuration tab. The
	    Query Configuration button on that tab manually queries the sign.
	</li>
	<li>The Status Tab on the DMS Form shows additional status information.
	</li>
    </ul>
</li>
</ol>
</p>

<h3 id="createplan">Create a Plan to Activate DMS Messages</h3>
<p>
<ol>
<li>Make sure <a href="#edit_mode">edit mode</a> is <b>ON</b>.</li>
<li>Select the <span class="menu">View ➔ Plans and Schedules</span> menu item to
    display the Plans and Schedules form.</li>
<li>Create a Phase (if it doesn't exist already)
    <ul>
	<li>Click the Plan Phases Tab</li>
	<li>Type the name of the new phase, e.g. "msg_on"</li>
	<li>Press the Create Button</li>
	<li>The new Phase should appear in the upper table</li>
    </ul>
</li>
<li>Create an Action Plan
    <ul>
	<li>Click the "Action Plans" tab</li>
	<li>Select the phase "msg_on" in the Default Phase combobox.</li>
	<li>Type the name of the new Action Plan in the edit field,
	    e.g. "slick_roads"</li>
	<li>Press the Create Button</li>
	<li>The new Plan should appear in the lower table</li>
    </ul>
</li>
<li>Create the DMS Actions
    <ul>
	<li>Click on the Action Plan just created (e.g. slick_roads)</li>
	<li>Click the DMS Actions tab</li>
	<li>In the edit field on the bottom of the form, type the name of an
	    existing sign group</li>
	<li>Press the Create button</li>
	<li>The new DMS Action should appear in the table</li>
	<li>Click on the "Quick Message" column in the DMS Action just created
	</li>
	<li>Specify the name of an existing <a href="#quick_msg">quick
	    message</a> to send to the sign
	</li>
	<li>Repeat the above DMS Actions steps as many times as desired to send
	    a message to additional sign groups.</li>
    </ul>
</li>
<li>Activate the messages on the signs
    <ul>
	<li>On the Action Plans tab, click the desired action plan.</li>
	<li>Click the "Active" checkbox.</li>
	<li>Signs are activated and deactivated every 30 seconds (at :29 and
	    :59), so wait at least 30 seconds for the messages to appear or
	    disappear.</li>
	<li>Unselect the Active checkbox to blank the signs.</li>
    </ul>
</li>
</ol>
Notes:
<ul>
	<li>Before running through these steps, create the Sign Groups and Quick
	    Messages desired.</li>
	<li>The quick messages that the Action Plan references don't have to be
	    assigned to a Sign Group.</li>
	<li>Use the device debug log to diagnose problems with scheduled
	    messages not appearing on signs.</li>
</ul>

</p>
</main>

</body>
</html>
